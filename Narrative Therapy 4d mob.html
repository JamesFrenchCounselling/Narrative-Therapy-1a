<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Section 4d: Challenges and Adversity</title>
  <!-- Mobile-friendly viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Prevent iOS from randomly resizing some text blocks */
    html {
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
      height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #1e3a8a 0, #4f46e5 25%, #ec4899 60%, #f97316 100%);
      color: #111827;
      min-height: 100%;
    }

    .layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      display: flex;
      align-items: flex-start;
      gap: 24px;
      min-height: 100vh; /* ensure it fills full screen height on mobile */
    }

    .sidebar {
      width: 260px;
      flex: 0 0 260px;
      position: sticky;
      top: 16px;
      align-self: flex-start;
    }

    .page {
      flex: 1;
      min-width: 0;
    }

    h1 {
      font-size: 1.9rem;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #f9fafb;
      text-shadow: 0 2px 10px rgba(0,0,0,0.45);
    }

    h1 span.badge {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(251,191,36,0.95);
      color: #78350f;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }

    p.intro {
      margin-top: 0;
      margin-bottom: 1.2rem;
      font-size: 0.95rem;
      color: #e5e7eb;
      max-width: 760px;
      text-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }

    /* Timer only in sidebar */
    .timer {
      display: inline-flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 3px;
      padding: 8px 11px;
      border-radius: 16px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(248,250,252,0.2);
      box-shadow: 0 6px 18px rgba(15,23,42,0.7);
      font-size: 0.88rem;
      color: #e5e7eb;
    }

    .timer span.label {
      opacity: 0.8;
      font-size: 0.78rem;
    }

    .timer span.time {
      font-weight: 800;
      font-size: 1.2rem;
      letter-spacing: 0.08em;
    }

    .timer.ending {
      border-color: #f97373;
      color: #fecaca;
      box-shadow: 0 0 14px rgba(248,113,113,0.7);
    }

    .timer.up {
      opacity: 0.7;
    }

    .time-up-banner {
      display: none;
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(254,242,242,0.96);
      color: #991b1b;
      border: 1px solid #fecaca;
      font-size: 0.84rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .time-up .time-up-banner {
      display: block;
    }

    .time-up #reflectionForm input,
    .time-up #reflectionForm textarea {
      pointer-events: none;
      opacity: 0.9;
    }

    .card {
      background: #f9fafb;
      border-radius: 18px;
      padding: 18px 16px;
      box-shadow: 0 10px 22px rgba(15,23,42,0.25);
      border: 1px solid #e5e7eb;
      position: relative;
      overflow: hidden;
    }

    .card-title {
      font-weight: 700;
      margin-bottom: 6px;
      color: #111827;
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
      color: #111827;
    }

    .question-text {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }

    textarea,
    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font: inherit;
      background: #ffffff;
      min-height: 70px;
      resize: vertical;
      transition: border-color 0.15s ease-out, box-shadow 0.15s ease-out, transform 0.05s ease-out;
    }

    textarea:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 2px rgba(129,140,248,0.4);
      transform: translateY(-1px);
    }

    .options-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin: 8px 0 10px;
    }

    .option-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(129,140,248,0.7);
      font-size: 0.95rem; /* consistent font size for all options */
      line-height: 1.35;
      background: rgba(239,246,255,0.95);
      cursor: pointer;
      user-select: none;
      transition: transform 0.05s ease-out, box-shadow 0.05s ease-out, background 0.1s ease-out, border-color 0.1s ease-out, color 0.1s ease-out;
    }

    .option-pill input {
      accent-color: #4b6bfb;
    }

    .option-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(148,163,184,0.8);
    }

    .option-pill.selected {
      background: linear-gradient(135deg, #22c55e, #a855f7);
      color: #f9fafb;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(55,65,81,0.7);
    }

    .option-pill.selected input {
      accent-color: #fef9c3;
    }

    .sub-question-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }

    .step {
      display: none;
    }

    .step.active {
      display: block;
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 14px;
      gap: 10px;
    }

    button {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-weight: 700;
      font-size: 0.9rem;
      background: radial-gradient(circle at 0% 0%, #f97316, #ec4899, #6366f1);
      color: #f9fafb;
      box-shadow: 0 8px 18px rgba(15,23,42,0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: transform 0.07s ease, box-shadow 0.07s ease, opacity 0.1s ease;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 11px 22px rgba(15,23,42,0.8);
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow: 0 5px 11px rgba(15,23,42,0.75);
    }

    button:disabled {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
    }

    .secondary {
      background: #e5e7eb;
      color: #111827;
      box-shadow: 0 4px 10px rgba(55,65,81,0.5);
      text-transform: none;
      letter-spacing: 0.01em;
    }

    #resultsBox {
      width: 100%;
      min-height: 200px;
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      border: 1px dashed #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.9rem;
      background: #f9fafb;
      box-shadow: inset 0 0 8px rgba(148,163,184,0.5);
      white-space: pre-wrap;
    }

    .status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #16a34a;
      min-height: 1.2em;
    }

    .footer-note {
      margin-top: 12px;
      font-size: 0.8rem;
      color: #e5e7eb;
    }

    @media (max-width: 900px) {
      .layout {
        flex-direction: column;
        align-items: stretch;
      }

      .sidebar {
        width: 100%;
        flex: none;
        position: static;
        order: -1;
        margin-bottom: 12px;
      }
    }
  </style>
</head>
<body>
<div class="layout">
  <!-- Sidebar with timer only -->
  <aside class="sidebar">
    <div class="timer" id="timer">
      <span class="label">‚è±Ô∏è Time left (Section 4d)</span>
      <span class="time" id="timeRemaining">30:00</span>
      <span style="font-size:0.75rem; opacity:0.75;">Up to 30 minutes to complete this week's narrative.</span>
    </div>
  </aside>

  <!-- Main question page -->
  <main class="page">
    <h1>Section 4d: Challenges and Adversity</h1>
    <p class="intro">
      This sequence explores moments of struggle, loss, and isolation, and how you found resilience and support.
      Move through Questions 12, 13, and 14 step by step. At the end you‚Äôll be able to copy a formatted
      reflection to send on.
    </p>

    <div class="time-up-banner" id="timeUpBanner">
      The 30 minutes for this reflection have finished. Your answers are still here ‚Äì you can review them and copy them at the end.
    </div>

    <form id="reflectionForm">
      <!-- STEP 1 ‚Äì QUESTION 12 -->
      <div class="step active" data-step="1">
        <div class="card question" data-question="12. Hitting rock bottom and resilience">
          <div class="card-title">Question 12 ‚Äì Hitting rock bottom</div>

          <div class="sub-question">
            <div class="sub-question-title">
              Think about a moment when you felt like you had hit rock bottom.
            </div>
            <div class="question-text">
              How did you find resilience during this time?
            </div>

            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q12" value="Leaned on loved ones or a support network.">
                A. Leaned on loved ones or a support network.
              </label>
              <label class="option-pill">
                <input type="radio" name="q12" value="Focused on rediscovering your strengths or purpose.">
                B. Focused on rediscovering your strengths or purpose.
              </label>
              <label class="option-pill">
                <input type="radio" name="q12" value="Sought professional help or therapy.">
                C. Sought professional help or therapy.
              </label>
              <label class="option-pill">
                <input type="radio" name="q12" value="Took things one step at a time, rebuilding slowly.">
                D. Took things one step at a time, rebuilding slowly.
              </label>
              <label class="option-pill">
                <input type="radio" name="q12" value="Other/Not Listed (please specify).">
                E. Other/Not Listed (please specify):
              </label>
            </div>

            <textarea id="q12_other"
              placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe how you found resilience in more detail, you can write about it here."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <span></span>
          <button type="button" id="next1" disabled>Next ‚Æï</button>
        </div>
      </div>

      <!-- STEP 2 ‚Äì QUESTION 12a -->
      <div class="step" data-step="2">
        <div class="card question" data-question="12a. Lessons learned from rock bottom">
          <div class="card-title">Question 12a ‚Äì Lessons learned</div>

          <div class="sub-question">
            <div class="question-text">
              What lessons did you learn from the experience?
            </div>

            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q12a" value="The importance of asking for help when needed.">
                A. The importance of asking for help when needed.
              </label>
              <label class="option-pill">
                <input type="radio" name="q12a" value="How resilient and capable you truly are.">
                B. How resilient and capable you truly are.
              </label>
              <label class="option-pill">
                <input type="radio" name="q12a" value="The value of prioritising self-care and well-being.">
                C. The value of prioritising self-care and well-being.
              </label>
              <label class="option-pill">
                <input type="radio" name="q12a" value="How to identify and avoid the patterns that led to the situation.">
                D. How to identify and avoid the patterns that led to the situation.
              </label>
              <label class="option-pill">
                <input type="radio" name="q12a" value="Other/Not Listed (please specify).">
                E. Other/Not Listed (please specify):
              </label>
            </div>

            <textarea id="q12a_other"
              placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe your lessons in more detail, you can write about it here."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back2">‚Æú Back</button>
          <button type="button" id="next2" disabled>Next ‚Æï</button>
        </div>
      </div>

      <!-- STEP 3 ‚Äì OPTIONAL FOLLOW-UP FOR 12 -->
      <div class="step" data-step="3">
        <div class="card question" data-question="12 ‚Äì Optional follow-up">
          <div class="card-title">Optional follow-up ‚Äì Question 12</div>

          <div class="sub-question">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              If you were to face a similar situation again, what would you do differently, if anything?
            </div>
            <textarea id="q12_follow"
              placeholder="You might write about boundaries you‚Äôd set, support you‚Äôd ask for, or mindsets you‚Äôd carry into a similar experience."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back3">‚Æú Back</button>
          <button type="button" id="next3">Next ‚Æï</button>
        </div>
      </div>

      <!-- STEP 4 ‚Äì QUESTION 13 -->
      <div class="step" data-step="4">
        <div class="card question" data-question="13. Grieving a major disappointment or loss">
          <div class="card-title">Question 13 ‚Äì Grieving loss</div>

          <div class="sub-question">
            <div class="sub-question-title">
              Can you recall a time when you experienced a major disappointment or loss?
            </div>
            <div class="question-text">
              How did you grieve the loss?
            </div>

            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q13" value="Allowed yourself to fully experience and process the emotions.">
                A. Allowed yourself to fully experience and process the emotions.
              </label>
              <label class="option-pill">
                <input type="radio" name="q13" value="Found comfort in loved ones or a support network.">
                B. Found comfort in loved ones or a support network.
              </label>
              <label class="option-pill">
                <input type="radio" name="q13" value="Sought closure through reflection or rituals.">
                C. Sought closure through reflection or rituals.
              </label>
              <label class="option-pill">
                <input type="radio" name="q13" value="Channelled your feelings into meaningful action or creativity.">
                D. Channelled your feelings into meaningful action or creativity.
              </label>
              <label class="option-pill">
                <input type="radio" name="q13" value="Other/Not Listed (please specify).">
                E. Other/Not Listed (please specify):
              </label>
            </div>

            <textarea id="q13_other"
              placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe how you grieved in more detail, you can write about it here."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back4">‚Æú Back</button>
          <button type="button" id="next4" disabled>Next ‚Æï</button>
        </div>
      </div>

      <!-- STEP 5 ‚Äì QUESTION 13a -->
      <div class="step" data-step="5">
        <div class="card question" data-question="13a. Perspective after loss">
          <div class="card-title">Question 13a ‚Äì Changing perspective</div>

          <div class="sub-question">
            <div class="question-text">
              How did this experience change your perspective?
            </div>

            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q13a" value="Gained a deeper appreciation for what you have.">
                A. Gained a deeper appreciation for what you have.
              </label>
              <label class="option-pill">
                <input type="radio" name="q13a" value="Became more resilient or adaptable.">
                B. Became more resilient or adaptable.
              </label>
              <label class="option-pill">
                <input type="radio" name="q13a" value="Developed a better understanding of life‚Äôs unpredictability.">
                C. Developed a better understanding of life‚Äôs unpredictability.
              </label>
              <label class="option-pill">
                <input type="radio" name="q13a" value="Realised the importance of cherishing relationships or moments.">
                D. Realised the importance of cherishing relationships or moments.
              </label>
              <label class="option-pill">
                <input type="radio" name="q13a" value="Other/Not Listed (please specify).">
                E. Other/Not Listed (please specify):
              </label>
            </div>

            <textarea id="q13a_other"
              placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe your perspective shift in more detail, you can write about it here."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back5">‚Æú Back</button>
          <button type="button" id="next5" disabled>Next ‚Æï</button>
        </div>
      </div>

      <!-- STEP 6 ‚Äì OPTIONAL FOLLOW-UP FOR 13 -->
      <div class="step" data-step="6">
        <div class="card question" data-question="13 ‚Äì Optional follow-up">
          <div class="card-title">Optional follow-up ‚Äì Question 13</div>

          <div class="sub-question">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              What helped you find meaning or a new sense of purpose after the loss?
            </div>
            <textarea id="q13_follow"
              placeholder="You might write about people, practices, beliefs, or actions that helped you find meaning again."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back6">‚Æú Back</button>
          <button type="button" id="next6">Next ‚Æï</button>
        </div>
      </div>

      <!-- STEP 7 ‚Äì QUESTION 14 -->
      <div class="step" data-step="7">
        <div class="card question" data-question="14. Feeling isolated or alone and reaching out">
          <div class="card-title">Question 14 ‚Äì Isolation and reaching out</div>

          <div class="sub-question">
            <div class="sub-question-title">
              Reflect on a time when you felt isolated or alone.
            </div>
            <div class="question-text">
              How did you reach out for support?
            </div>

            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q14" value="Confided in a friend, family member, or trusted person.">
                A. Confided in a friend, family member, or trusted person.
              </label>
              <label class="option-pill">
                <input type="radio" name="q14" value="Joined a group or community with shared interests or values.">
                B. Joined a group or community with shared interests or values.
              </label>
              <label class="option-pill">
                <input type="radio" name="q14" value="Sought professional help or counselling.">
                C. Sought professional help or counselling.
              </label>
              <label class="option-pill">
                <input type="radio" name="q14" value="Took small steps to reconnect with others or build new relationships.">
                D. Took small steps to reconnect with others or build new relationships.
              </label>
              <label class="option-pill">
                <input type="radio" name="q14" value="Other/Not Listed (please specify).">
                E. Other/Not Listed (please specify):
              </label>
            </div>

            <textarea id="q14_other"
              placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe how you reached out in more detail, you can write about it here."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back7">‚Æú Back</button>
          <button type="button" id="next7" disabled>Next ‚Æï</button>
        </div>
      </div>

      <!-- STEP 8 ‚Äì QUESTION 14a -->
      <div class="step" data-step="8">
        <div class="card question" data-question="14a. Learning about connection and community">
          <div class="card-title">Question 14a ‚Äì Connection and community</div>

          <div class="sub-question">
            <div class="question-text">
              What did you learn about connection and community?
            </div>

            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q14a" value="How much others are willing to help if you ask.">
                A. How much others are willing to help if you ask.
              </label>
              <label class="option-pill">
                <input type="radio" name="q14a" value="The value of building and maintaining meaningful relationships.">
                B. The value of building and maintaining meaningful relationships.
              </label>
              <label class="option-pill">
                <input type="radio" name="q14a" value="That vulnerability is key to forming deeper bonds.">
                C. That vulnerability is key to forming deeper bonds.
              </label>
              <label class="option-pill">
                <input type="radio" name="q14a" value="That even small connections can have a big impact.">
                D. That even small connections can have a big impact.
              </label>
              <label class="option-pill">
                <input type="radio" name="q14a" value="Other/Not Listed (please specify).">
                E. Other/Not Listed (please specify):
              </label>
            </div>

            <textarea id="q14a_other"
              placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe your learning in more detail, you can write about it here."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back8">‚Æú Back</button>
          <button type="button" id="next8" disabled>Next ‚Æï</button>
        </div>
      </div>

      <!-- STEP 9 ‚Äì OPTIONAL FOLLOW-UP FOR 14 -->
      <div class="step" data-step="9">
        <div class="card question" data-question="14 ‚Äì Optional follow-up">
          <div class="card-title">Optional follow-up ‚Äì Question 14</div>

          <div class="sub-question">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              What steps could you take now to strengthen your sense of connection and community?
            </div>
            <textarea id="q14_follow"
              placeholder="You might write about concrete actions, invitations, or communities you‚Äôd like to lean into."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back9">‚Æú Back</button>
          <button type="button" id="finishBtn" disabled>Finish</button>
        </div>
      </div>
    </form>

    <div id="resultsSection" style="display:none; margin-top:20px;">
      <h2 style="color:#f9fafb; text-shadow:0 2px 6px rgba(0,0,0,0.45);">Your Reflection Export</h2>
      <p class="intro">
        Below is your formatted reflection. It includes every option for each question, plus your written notes.
      </p>
      <button type="button" id="copyButton">üìã Copy this reflection</button>
      <div class="status" id="statusMessage"></div>
      <textarea id="resultsBox" readonly></textarea>
      <p class="footer-note">
        After clicking ‚ÄúCopy this reflection‚Äù, go to your email or message app and use
        <strong>Paste</strong> (Ctrl+V / Cmd+V).
      </p>
    </div>
  </main>
</div>

<script>
  // ES5-friendly script with no arrow functions / let / const

  // ---------- TIMER (30 MINUTES) ----------
  var totalSeconds = 30 * 60;
  var timerInterval = null;
  var timeUp = false;
  var timerEl = document.getElementById('timer');
  var timeRemainingEl = document.getElementById('timeRemaining');
  var timeUpBanner = document.getElementById('timeUpBanner');

  function formatTime(seconds) {
    var m = Math.floor(seconds / 60);
    var s = seconds % 60;
    var mm = m < 10 ? '0' + m : '' + m;
    var ss = s < 10 ? '0' + s : '' + s;
    return mm + ':' + ss;
  }

  function startTimer() {
    timeRemainingEl.textContent = formatTime(totalSeconds);
    timerInterval = setInterval(function() {
      totalSeconds--;
      if (totalSeconds <= 0) {
        totalSeconds = 0;
        clearInterval(timerInterval);
        handleTimeUp();
      }
      timeRemainingEl.textContent = formatTime(totalSeconds);
      if (totalSeconds <= 60 && !timeUp) {
        if (timerEl.className.indexOf('ending') === -1) {
          timerEl.className += ' ending';
        }
      }
    }, 1000);
  }

  function handleTimeUp() {
    timeUp = true;
    timerEl.className = timerEl.className.replace(' ending', '');
    if (timerEl.className.indexOf(' up') === -1) {
      timerEl.className += ' up';
    }
    if (document.body.className.indexOf('time-up') === -1) {
      document.body.className += ' time-up';
    }
    timeUpBanner.style.display = 'block';
    var allInputs = document.querySelectorAll('#reflectionForm input, #reflectionForm textarea');
    for (var i = 0; i < allInputs.length; i++) {
      allInputs[i].disabled = true;
    }
  }

  // ---------- STEPS ----------
  var steps = document.querySelectorAll('.step');
  var currentStep = 1;
  var totalSteps = steps.length; // 9

  function showStep(stepNumber) {
    for (var i = 0; i < steps.length; i++) {
      var step = steps[i];
      var target = Number(step.getAttribute('data-step')) === stepNumber;
      if (target) {
        if (step.className.indexOf('active') === -1) {
          step.className += ' active';
        }
      } else {
        step.className = step.className.replace(' active', '');
      }
    }
    currentStep = stepNumber;
    enableOrDisableButtonsForStep(stepNumber);
  }

  // ---------- ANSWER CHECKING (for enabling Next/Finish) ----------
  function isMainQuestionAnswered(stepNumber) {
    var step = document.querySelector('.step[data-step="' + stepNumber + '"]');
    if (!step) return false;

    var checked = step.querySelector('input[type="radio"]:checked, input[type="checkbox"]:checked');
    if (checked) return true;

    var fields = step.querySelectorAll('textarea, input[type="text"]');
    for (var i = 0; i < fields.length; i++) {
      if (fields[i].value && fields[i].value.trim() !== '') {
        return true;
      }
    }
    return false;
  }

  function checkQuestionReward(stepNumber) {
    // intentionally empty (placeholder if you want to add gamified rewards later)
  }

  // simple helper to find closest parent with a class (for older Safari)
  function closestWithClass(element, className, stopAt) {
    while (element && element !== stopAt && element.nodeType === 1) {
      if ((' ' + element.className + ' ').indexOf(' ' + className + ' ') > -1) {
        return element;
      }
      element = element.parentNode;
    }
    return null;
  }

  // ---------- OPTION PILL SELECTION ----------
  var optionGroups = document.querySelectorAll('.options-group');
  for (var og = 0; og < optionGroups.length; og++) {
    optionGroups[og].addEventListener('change', function(e) {
      var target = e.target || e.srcElement;
      if (!target || target.tagName !== 'INPUT') return;

      var pill = closestWithClass(target, 'option-pill', this);
      if (!pill) return;

      if (target.type === 'radio') {
        var allPills = this.querySelectorAll('.option-pill');
        for (var i = 0; i < allPills.length; i++) {
          allPills[i].className = allPills[i].className.replace(' selected', '');
        }
        if (pill.className.indexOf('selected') === -1) {
          pill.className += ' selected';
        }
      } else if (target.type === 'checkbox') {
        if (target.checked) {
          if (pill.className.indexOf('selected') === -1) {
            pill.className += ' selected';
          }
        } else {
          pill.className = pill.className.replace(' selected', '');
        }
      }

      var stepEl = closestWithClass(target, 'step', document.body);
      if (stepEl) {
        var stepNumber = Number(stepEl.getAttribute('data-step'));
        enableOrDisableButtonsForStep(stepNumber);
        checkQuestionReward(stepNumber);
      }
    });
  }

  // Also update when typing
  var reflectionForm = document.getElementById('reflectionForm');
  reflectionForm.addEventListener('input', function(e) {
    var target = e.target || e.srcElement;
    var stepEl = closestWithClass(target, 'step', document.body);
    if (stepEl) {
      var stepNumber = Number(stepEl.getAttribute('data-step'));
      enableOrDisableButtonsForStep(stepNumber);
      checkQuestionReward(stepNumber);
    }
  });

  function enableOrDisableButtonsForStep(stepNumber) {
    var answered = isMainQuestionAnswered(stepNumber);

    // Steps 3, 6, and 9 are optional follow-ups:
    if (stepNumber === 3 || stepNumber === 6 || stepNumber === 9) {
      answered = true;
    }

    if (stepNumber === 1) {
      var next1 = document.getElementById('next1');
      if (next1) {
        next1.disabled = !answered;
      }
    } else if (stepNumber === 2) {
      var next2 = document.getElementById('next2');
      if (next2) {
        next2.disabled = !answered;
      }
    } else if (stepNumber === 3) {
      var next3 = document.getElementById('next3');
      if (next3) {
        next3.disabled = !answered;
      }
    } else if (stepNumber === 4) {
      var next4 = document.getElementById('next4');
      if (next4) {
        next4.disabled = !answered;
      }
    } else if (stepNumber === 5) {
      var next5 = document.getElementById('next5');
      if (next5) {
        next5.disabled = !answered;
      }
    } else if (stepNumber === 6) {
      var next6 = document.getElementById('next6');
      if (next6) {
        next6.disabled = !answered;
      }
    } else if (stepNumber === 7) {
      var next7 = document.getElementById('next7');
      if (next7) {
        next7.disabled = !answered;
      }
    } else if (stepNumber === 8) {
      var next8 = document.getElementById('next8');
      if (next8) {
        next8.disabled = !answered;
      }
    } else if (stepNumber === 9) {
      var finishBtn = document.getElementById('finishBtn');
      if (finishBtn) {
        finishBtn.disabled = !answered;
      }
    }
  }

  // ---------- STEP NAV BUTTONS ----------
  var next1 = document.getElementById('next1');
  var back2 = document.getElementById('back2');
  var next2 = document.getElementById('next2');
  var back3 = document.getElementById('back3');
  var next3 = document.getElementById('next3');
  var back4 = document.getElementById('back4');
  var next4 = document.getElementById('next4');
  var back5 = document.getElementById('back5');
  var next5 = document.getElementById('next5');
  var back6 = document.getElementById('back6');
  var next6 = document.getElementById('next6');
  var back7 = document.getElementById('back7');
  var next7 = document.getElementById('next7');
  var back8 = document.getElementById('back8');
  var next8 = document.getElementById('next8');
  var back9 = document.getElementById('back9');
  var finishBtn = document.getElementById('finishBtn');

  if (next1) {
    next1.addEventListener('click', function() {
      showStep(2);
    });
  }
  if (back2) {
    back2.addEventListener('click', function() {
      showStep(1);
    });
  }
  if (next2) {
    next2.addEventListener('click', function() {
      showStep(3);
    });
  }
  if (back3) {
    back3.addEventListener('click', function() {
      showStep(2);
    });
  }
  if (next3) {
    next3.addEventListener('click', function() {
      showStep(4);
    });
  }
  if (back4) {
    back4.addEventListener('click', function() {
      showStep(3);
    });
  }
  if (next4) {
    next4.addEventListener('click', function() {
      showStep(5);
    });
  }
  if (back5) {
    back5.addEventListener('click', function() {
      showStep(4);
    });
  }
  if (next5) {
    next5.addEventListener('click', function() {
      showStep(6);
    });
  }
  if (back6) {
    back6.addEventListener('click', function() {
      showStep(5);
    });
  }
  if (next6) {
    next6.addEventListener('click', function() {
      showStep(7);
    });
  }
  if (back7) {
    back7.addEventListener('click', function() {
      showStep(6);
    });
  }
  if (next7) {
    next7.addEventListener('click', function() {
      showStep(8);
    });
  }
  if (back8) {
    back8.addEventListener('click', function() {
      showStep(7);
    });
  }
  if (next8) {
    next8.addEventListener('click', function() {
      showStep(9);
    });
  }
  if (back9) {
    back9.addEventListener('click', function() {
      showStep(8);
    });
  }

  // When finish clicked, show results section + generate export, then hide the Finish button
  if (finishBtn) {
    finishBtn.addEventListener('click', function() {
      generateExportText();
      document.getElementById('resultsSection').style.display = 'block';
      finishBtn.style.display = 'none'; // hide Finish on the final page
      document.getElementById('resultsSection').scrollIntoView();
    });
  }

  // Dash line used after each option
  var dashLine = '- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -';

  // ---------- EXPORT TEXT ----------
  function generateExportText() {
    var allQuestions = document.querySelectorAll('.card.question');
    var output = '';

    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    output += 'Section 4d: Challenges and Adversity ‚Äì Reflection Summary\n';
    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';
    output += 'For each question below, all possible options are listed.\n';
    output += 'Your own written notes follow each group of options where you added them.\n\n';

    for (var qIndex = 0; qIndex < allQuestions.length; qIndex++) {
      var q = allQuestions[qIndex];
      var mainPrompt = q.getAttribute('data-question') || ('Question ' + (qIndex + 1));

      output += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
      output += mainPrompt + '\n';

      var subTitleEl = q.querySelector('.sub-question-title');
      var subTitleText = subTitleEl ? subTitleEl.textContent.replace(/\s+/g, ' ').trim() : '';
      var qTextEls = q.querySelectorAll('.question-text');

      if (subTitleText) {
        output += '\n ‚ñ∏ ' + subTitleText + '\n';
      }

      for (var tIndex = 0; tIndex < qTextEls.length; tIndex++) {
        var qt = qTextEls[tIndex].textContent.replace(/\s+/g, ' ').trim();
        if (qt) {
          output += '   ' + qt + '\n';
        }
      }

      var groups = q.querySelectorAll('.options-group');
      for (var gIndex = 0; gIndex < groups.length; gIndex++) {
        var group = groups[gIndex];
        var labels = group.querySelectorAll('label.option-pill');
        if (labels.length > 0) {
          output += '\n Options:\n';
          for (var lIndex = 0; lIndex < labels.length; lIndex++) {
            var label = labels[lIndex];
            var labelText = label.textContent.replace(/\s+/g, ' ').trim();
            output += ' ' + labelText + '\n';
            output += dashLine + '\n';
          }
        }
      }

      var notes = [];
      var fields = q.querySelectorAll('textarea, input[type="text"]');
      for (var fIndex = 0; fIndex < fields.length; fIndex++) {
        var field = fields[fIndex];
        if (field.value && field.value.trim() !== '') {
          notes.push(field.value.trim());
        }
      }

      if (notes.length > 0) {
        output += ' Notes and narrative reflections:\n';
        for (var nIndex = 0; nIndex < notes.length; nIndex++) {
          output += ' ‚Ä¢ ' + notes[nIndex] + '\n';
        }
      } else {
        output += ' Notes and narrative reflections:\n';
        output += ' ‚Ä¢ (no additional written notes provided for this part)\n';
      }

      output += '\n';
    }

    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    output += 'End of Section 4d\n';
    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';

    document.getElementById('resultsBox').value = output;
  }

  // ---------- COPY BUTTON ----------
  var copyButton = document.getElementById('copyButton');
  copyButton.addEventListener('click', function() {
    var statusMessage = document.getElementById('statusMessage');
    var text = document.getElementById('resultsBox').value;

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text)
        .then(function() {
          statusMessage.textContent = '‚ú® Reflection copied! You can now paste it into an email or document.';
        })
        .catch(function() {
          statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
        });
    } else {
      var box = document.getElementById('resultsBox');
      box.focus();
      box.select();
      try {
        var successful = document.execCommand('copy');
        if (successful) {
          statusMessage.textContent = '‚ú® Reflection copied! You can now paste it into an email or document.';
        } else {
          statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
        }
      } catch (e) {
        statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
      }
    }
  });

  // ---------- INIT ----------
  startTimer();
  showStep(1);
  enableOrDisableButtonsForStep(1);
</script>
</body>
</html>
