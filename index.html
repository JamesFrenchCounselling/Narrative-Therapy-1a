<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Section 1c ‚Äì Identity Change, Conflict, Empowerment & Sharing</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #1e3a8a 0, #4f46e5 25%, #ec4899 60%, #f97316 100%);
      color: #111827;
    }
    .layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      display: flex;
      align-items: flex-start;
      gap: 24px;
    }
    .sidebar {
      width: 260px;
      flex: 0 0 260px;
      position: sticky;
      top: 16px;
      align-self: flex-start;
    }
    .page {
      flex: 1;
      min-width: 0;
    }
    h1 {
      font-size: 1.9rem;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #f9fafb;
      text-shadow: 0 2px 10px rgba(0,0,0,0.45);
    }
    h1 span.badge {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(251,191,36,0.95);
      color: #78350f;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }
    p.intro {
      margin-top: 0;
      margin-bottom: 1.2rem;
      font-size: 0.95rem;
      color: #e5e7eb;
      max-width: 760px;
      text-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }

    /* Sidebar cards (stats + timer) */
    .gamify-panel {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(30,64,175,0.98));
      border-radius: 18px;
      padding: 10px 14px;
      border: 1px solid rgba(191,219,254,0.3);
      box-shadow: 0 10px 25px rgba(15,23,42,0.7);
      color: #e5e7eb;
      position: relative;
      overflow: hidden;
      margin-bottom: 12px;
    }
    .gamify-panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(251,191,36,0.3) 0, transparent 50%),
        radial-gradient(circle at 80% 0%, rgba(236,72,153,0.3) 0, transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(34,197,94,0.3) 0, transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }
    .gamify-inner {
      position: relative;
      z-index: 1;
    }
    .gamify-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
      font-size: 0.84rem;
    }
    .gamify-header strong {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    #scoreLabel {
      font-weight: 700;
      font-size: 0.9rem;
      background: rgba(15,23,42,0.8);
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(248,250,252,0.15);
    }
    .progress-bar {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.7);
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.6);
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #fbbf24, #fb923c, #ec4899, #22c55e);
      background-size: 200% 100%;
      animation: progressGlow 4s linear infinite;
      transition: width 0.3s ease-out;
    }
    @keyframes progressGlow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }
    .progress-label {
      margin-top: 4px;
      font-size: 0.78rem;
      color: #e5e7eb;
    }
    .quest-log {
      margin-top: 4px;
      border-top: 1px solid rgba(148,163,184,0.35);
      padding-top: 4px;
    }
    .quest-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
      margin-bottom: 2px;
    }
    .quest-list {
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 0.75rem;
    }
    .quest-list li {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 2px;
      opacity: 0.9;
    }
    .quest-badge {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.68rem;
      background: rgba(15,23,42,0.8);
    }
    .quest-list li.completed {
      color: #bbf7d0;
    }
    .quest-list li.completed .quest-badge {
      background: radial-gradient(circle at 30% 0, #fef3c7 0, #22c55e 40%, #166534 100%);
      border-color: #bbf7d0;
      box-shadow: 0 0 6px rgba(34,197,94,0.9);
    }
    .quest-list li.completed .quest-badge::before {
      content: "‚úì";
    }
    .quest-list li:not(.completed) .quest-badge::before {
      content: "";
    }
    .reward-flash {
      margin-top: 2px;
      font-size: 0.78rem;
      color: #fef3c7;
      opacity: 0;
      transform: translateY(4px);
      transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    }
    .reward-flash.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .timer {
      display: inline-flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 3px;
      padding: 8px 11px;
      border-radius: 16px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(248,250,252,0.2);
      box-shadow: 0 6px 18px rgba(15,23,42,0.7);
      font-size: 0.88rem;
      color: #e5e7eb;
    }
    .timer span.label {
      opacity: 0.8;
      font-size: 0.78rem;
    }
    .timer span.time {
      font-weight: 800;
      font-size: 1.2rem;
      letter-spacing: 0.08em;
    }
    .timer.ending {
      border-color: #f97373;
      color: #fecaca;
      box-shadow: 0 0 14px rgba(248,113,113,0.7);
    }
    .timer.up {
      opacity: 0.7;
    }
    .time-up-banner {
      display: none;
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(254,242,242,0.96);
      color: #991b1b;
      border: 1px solid #fecaca;
      font-size: 0.84rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .time-up .time-up-banner {
      display: block;
    }
    .time-up #reflectionForm input,
    .time-up #reflectionForm textarea {
      pointer-events: none;
      opacity: 0.9;
    }

    .card {
      background: #f9fafb;
      border-radius: 18px;
      padding: 18px 16px;
      box-shadow: 0 10px 22px rgba(15,23,42,0.25);
      border: 1px solid #e5e7eb;
      position: relative;
      overflow: hidden;
    }
    .card-title {
      font-weight: 700;
      margin-bottom: 6px;
      color: #111827;
    }
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
      color: #111827;
    }
    .question-text {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }
    textarea,
    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font: inherit;
      background: #ffffff;
      min-height: 70px;
      resize: vertical;
      transition: border-color 0.15s ease-out, box-shadow 0.15s ease-out, transform 0.05s ease-out;
    }
    textarea:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 2px rgba(129,140,248,0.4);
      transform: translateY(-1px);
    }
    .options-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin: 8px 0 10px;
    }
    .option-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(129,140,248,0.7);
      font-size: 0.9rem;
      background: rgba(239,246,255,0.95);
      cursor: pointer;
      user-select: none;
      transition: transform 0.05s ease-out, box-shadow 0.05s ease-out, background 0.1s ease-out, border-color 0.1s ease-out, color 0.1s ease-out;
    }
    .option-pill input {
      accent-color: #4b6bfb;
    }
    .option-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(148,163,184,0.8);
    }
    .option-pill.selected {
      background: linear-gradient(135deg, #22c55e, #a855f7);
      color: #f9fafb;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(55,65,81,0.7);
    }
    .option-pill.selected input {
      accent-color: #fef9c3;
    }
    .sub-question {
      margin-top: 12px;
    }
    .sub-question-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 14px;
      gap: 10px;
    }
    button {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-weight: 700;
      font-size: 0.9rem;
      background: radial-gradient(circle at 0% 0%, #f97316, #ec4899, #6366f1);
      color: #f9fafb;
      box-shadow: 0 8px 18px rgba(15,23,42,0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: transform 0.07s ease, box-shadow 0.07s ease, opacity 0.1s ease;
    }
    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 11px 22px rgba(15,23,42,0.8);
    }
    button:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow: 0 5px 11px rgba(15,23,42,0.75);
    }
    button:disabled {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
    }
    .secondary {
      background: #e5e7eb;
      color: #111827;
      box-shadow: 0 4px 10px rgba(55,65,81,0.5);
      text-transform: none;
      letter-spacing: 0.01em;
    }
    #resultsBox {
      width: 100%;
      min-height: 200px;
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      border: 1px dashed #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.9rem;
      background: #f9fafb;
      box-shadow: inset 0 0 8px rgba(148,163,184,0.5);
      white-space: pre-wrap;
    }
    .status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #16a34a;
      min-height: 1.2em;
    }
    .footer-note {
      margin-top: 12px;
      font-size: 0.8rem;
      color: #e5e7eb;
    }

    @media (max-width: 900px) {
      .layout {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        flex: none;
        position: static;
        order: -1;
      }
    }
  </style>
</head>
<body>
<div class="layout">
  <!-- Sidebar with stats + timer -->
  <aside class="sidebar">
    <div class="gamify-panel">
      <div class="gamify-inner">
        <div class="gamify-header">
          <strong>Narrative Therapy Progress</strong>
          <span id="scoreLabel">0 XP</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-label" id="progressText">
          0% ‚Äì answer each card to level up your self-story ‚≠ê
        </div>
        <div class="quest-log">
          <div class="quest-title">Questions Completed</div>
          <ul class="quest-list">
            <li id="quest1"><span class="quest-badge"></span>Complete Question 1</li>
            <li id="quest2"><span class="quest-badge"></span>Complete Question 2</li>
            <li id="quest3"><span class="quest-badge"></span>Complete Question 3</li>
            <li id="quest4"><span class="quest-badge"></span>Complete Question 4 & copy</li>
          </ul>
        </div>
        <div class="reward-flash" id="rewardFlash">
          ‚≠ê +10 XP unlocked! Nice insight.
        </div>
      </div>
    </div>
    <div class="timer" id="timer">
      <span class="label">‚è±Ô∏è Time left (Section 1c)</span>
      <span class="time" id="timeRemaining">30:00</span>
      <span style="font-size:0.75rem; opacity:0.75;">Up to 30 minutes for this identity quest.</span>
    </div>
  </aside>

  <!-- Main question page -->
  <main class="page">
    <h1>
      Section 1c: Change, Conflict, Empowerment & Sharing
      <span class="badge">Narrative Quest</span>
    </h1>
    <p class="intro">
      This sequence explores identity changes, inner conflicts, empowered moments, and sharing your story with others.
      Move through Questions 1, 2, 3, and 4 one at a time. At the end you‚Äôll be able to copy a formatted reflection to send on.
    </p>

    <div class="time-up-banner" id="timeUpBanner">
      The 30 minutes for this reflection have finished. Your answers are still here ‚Äì you can review them and copy them at the end.
    </div>

    <form id="reflectionForm">
      <!-- STEP 1 ‚Äì QUESTION 1 -->
      <div class="step active" data-step="1">
        <div class="card question" data-question="1. A strong sense of your identity">
          <div class="card-title">Question 1 ‚Äì A strong sense of your identity</div>

          <div class="sub-question" data-subquestion="1a. Circumstances that contributed to your strong sense of identity">
            <div class="sub-question-title">
              Reflect on a moment when you felt a strong sense of your own identity.
            </div>
            <div class="question-text">
              What were the circumstances that contributed to your strong sense of identity?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q7a" value="Achieving a significant personal or professional milestone.">
                A. Achieving a significant personal or professional milestone.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7a" value="Overcoming a challenge or adversity.">
                B. Overcoming a challenge or adversity.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7a" value="Receiving affirmation or recognition from others.">
                C. Receiving affirmation or recognition from others.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7a" value="Engaging in an activity or tradition that felt meaningful.">
                D. Engaging in an activity or tradition that felt meaningful.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7a" value="Discovering or reconnecting with a value, belief, or passion you hold dear.">
                E. Discovering or reconnecting with a value, belief, or passion you hold dear.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7a" value="Other / Not Listed (please specify).">
                F. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q7a_other" placeholder="If ‚ÄòOther‚Äô, or if you‚Äôd like to describe this moment more fully, you can write about it here."></textarea>
          </div>

          <div class="sub-question" data-subquestion="1b. How this moment shaped your self-perception">
            <div class="sub-question-title">
              How did this moment shape and influence your understanding of your self-perception?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q7b" value="It strengthened your confidence in who you are.">
                A. It strengthened your confidence in who you are.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7b" value="It clarified what matters most to you.">
                B. It clarified what matters most to you.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7b" value="It helped you to see your strengths more clearly.">
                C. It helped you to see your strengths more clearly.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7b" value="It inspired you to embrace your individuality.">
                D. It inspired you to embrace your individuality.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7b" value="It reinforced a sense of connection to your values or your heritage.">
                E. It reinforced a sense of connection to your values or your heritage.
              </label>
              <label class="option-pill">
                <input type="radio" name="q7b" value="Other / Not Listed (please specify).">
                F. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q7b_other" placeholder="If ‚ÄòOther‚Äô, or if you‚Äôd like to say more about how this shaped your self-perception, you can write it here."></textarea>
          </div>

          <div class="sub-question" data-subquestion="1c. Using this experience to reinforce your identity in challenging times">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              How can you draw on this experience to reinforce your sense of identity, especially during challenging or uncertain times?
            </div>
            <textarea id="q7_follow" placeholder="You might write about practices, reminders, people, or environments that help you reconnect with this strong sense of identity."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <span></span>
          <button type="button" id="next1" disabled>Next Question ‚Æï</button>
        </div>
      </div>

      <!-- STEP 2 ‚Äì QUESTION 2 -->
      <div class="step" data-step="2">
        <div class="card question" data-question="2. Questioning or doubting an aspect of your identity">
          <div class="card-title">Question 2 ‚Äì Questioning an aspect of your identity</div>

          <div class="sub-question" data-subquestion="2a. Factors that prompted you to question your identity">
            <div class="sub-question-title">
              Think about a time when you questioned or doubted an important aspect of your identity.
            </div>
            <div class="question-text">
              What were the specific factors or experiences that prompted you to question this aspect of your identity?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q8a" value="A major life event or a time of transition.">
                A. A major life event or a time of transition.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8a" value="Feedback or criticism from others.">
                B. Feedback or criticism from others.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8a" value="Exposure to new ideas or perspectives.">
                C. Exposure to new ideas or perspectives.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8a" value="Internal doubts or self-reflection.">
                D. Internal doubts or self-reflection.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8a" value="Experiencing a sense of disconnect between your identity and your environment.">
                E. Experiencing a sense of disconnect between your identity and your environment.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8a" value="Other / Not Listed (please specify).">
                F. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q8a_other" placeholder="If ‚ÄòOther‚Äô, or if you‚Äôd like to describe this questioning in more detail, you can write about it here."></textarea>
          </div>

          <div class="sub-question" data-subquestion="2b. What you discovered or realised through this questioning">
            <div class="sub-question-title">
              What did you discover or realise about yourself through this process of questioning your identity?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q8b" value="Greater clarity about your values or priorities.">
                A. Greater clarity about your values or priorities.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8b" value="New aspects of yourself you had not hitherto explored.">
                B. New aspects of yourself you had not hitherto explored.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8b" value="That your identity is flexible and evolving.">
                C. That your identity is flexible and evolving.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8b" value="Strength in areas you had not recognised before.">
                D. Strength in areas you had not recognised before.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8b" value="The importance of authenticity and aligning with your true self.">
                E. The importance of authenticity and aligning with your true self.
              </label>
              <label class="option-pill">
                <input type="radio" name="q8b" value="Other / Not Listed (please specify).">
                F. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q8b_other" placeholder="If ‚ÄòOther‚Äô, or if you‚Äôd like to expand on what you discovered, you can write it here."></textarea>
          </div>

          <div class="sub-question" data-subquestion="2c. What this taught you about questioning and evolving your identity">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              What did you learn about the process of questioning and evolving your identity, and how has this shaped your current self-perception and life choices?
            </div>
            <textarea id="q8_follow" placeholder="You might write about what you now know about yourself when your identity feels like it is shifting or being challenged."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back2">‚Æú Back</button>
          <button type="button" id="next2" disabled>Next Question ‚Æï</button>
        </div>
      </div>

      <!-- STEP 3 ‚Äì QUESTION 3 -->
      <div class="step" data-step="3">
        <div class="card question" data-question="3. A deep sense of pride in who you are">
          <div class="card-title">Question 3 ‚Äì Feeling proud of who you are</div>

          <div class="sub-question" data-subquestion="3a. Factors that contributed to this feeling of pride">
            <div class="sub-question-title">
              Think about a specific moment when you felt a deep sense of pride in who you are.
            </div>
            <div class="question-text">
              What were the key factors or experiences that contributed to this feeling of pride?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q9a" value="Overcoming a personal challenge or achieving a goal.">
                A. Overcoming a personal challenge or achieving a goal.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9a" value="Being recognised for your unique qualities.">
                B. Being recognised for your unique qualities.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9a" value="Advocating for yourself or standing up for your values.">
                C. Advocating for yourself or standing up for your values.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9a" value="Connecting with your cultural, family, or personal history.">
                D. Connecting with your cultural, family, or personal history.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9a" value="Mentoring, supporting, or inspiring someone else in a meaningful way.">
                E. Mentoring, supporting, or inspiring someone else in a meaningful way.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9a" value="Other / Not Listed (please specify).">
                F. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q9a_other" placeholder="If ‚ÄòOther‚Äô, or if you‚Äôd like to describe this proud moment more fully, you can write about it here."></textarea>
          </div>

          <div class="sub-question" data-subquestion="3b. How this experience impacted your life">
            <div class="sub-question-title">
              How did this experience impact or influence your personal or professional life?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q9b" value="It inspired you to set new goals.">
                A. It inspired you to set new goals.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9b" value="It strengthened your confidence in your abilities.">
                B. It strengthened your confidence in your abilities.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9b" value="It deepened your appreciation for your journey.">
                C. It deepened your appreciation for your journey.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9b" value="It motivated you to share your story with others.">
                D. It motivated you to share your story with others.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9b" value="It enhanced your understanding of the value of perseverance.">
                E. It enhanced your understanding of the value of perseverance.
              </label>
              <label class="option-pill">
                <input type="radio" name="q9b" value="Other / Not Listed (please specify).">
                F. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q9b_other" placeholder="If ‚ÄòOther‚Äô, or if you‚Äôd like to describe the impact in more detail, you can write it here."></textarea>
          </div>

          <div class="sub-question" data-subquestion="3c. Celebrating and integrating the qualities that made you proud">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              How can you celebrate and honour the qualities that made you proud in that moment, and how can you integrate them into your daily life moving forward?
            </div>
            <textarea id="q9_follow" placeholder="You might write about habits, rituals, or reminders that keep these proud qualities alive in daily life."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back3">‚Æú Back</button>
          <button type="button" id="next3" disabled>Next Question ‚Æï</button>
        </div>
      </div>

      <!-- STEP 4 ‚Äì FINAL REFLECTION (no multiple choice) -->
      <div class="step" data-step="4">
        <div class="card question" data-question="4. Final reflection on your identity journey">
          <div class="card-title">Question 4 ‚Äì Final reflection on your identity journey</div>

          <div class="sub-question" data-subquestion="Final reflection. Which question felt most significant and why it resonated">
            <div class="sub-question-title">Final Question for Reflection</div>
            <div class="question-text">
              Which of these questions felt the most significant to you, and why do you feel it resonated?
            </div>
            <textarea id="q_final" placeholder="You can name the question number(s) and describe why they mattered or stood out to you."></textarea>
          </div>
        </div>

        <div class="nav-buttons">
          <button type="button" class="secondary" id="back4">‚Æú Back</button>
          <button type="button" id="finishBtn" disabled>Finish</button>
        </div>
      </div>
    </form>

    <div id="resultsSection" style="display:none; margin-top:20px;">
      <h2 style="color:#f9fafb; text-shadow:0 2px 6px rgba(0,0,0,0.45);">Your Reflection Export</h2>
      <p class="intro">
        Below is your formatted reflection. It includes every option for each question, plus your written notes.
        Symbol lines (40 dashes each) appear between the options simply to keep the sections visually separated.
      </p>
      <button type="button" id="copyButton">üìã Copy this reflection</button>
      <div class="status" id="statusMessage"></div>
      <textarea id="resultsBox" readonly></textarea>
      <p class="footer-note">
        After clicking ‚ÄúCopy this reflection‚Äù, go to your email or message app and use <strong>Paste</strong> (Ctrl+V / Cmd+V).
      </p>
    </div>
  </main>
</div>

<script>
  // ES5-friendly script

  // ---------- TIMER (30 MINUTES) ----------
  var totalSeconds = 30 * 60;
  var timerInterval = null;
  var timeUp = false;
  var timerEl = document.getElementById('timer');
  var timeRemainingEl = document.getElementById('timeRemaining');
  var timeUpBanner = document.getElementById('timeUpBanner');

  function formatTime(seconds) {
    var m = Math.floor(seconds / 60);
    var s = seconds % 60;
    var mm = m < 10 ? '0' + m : '' + m;
    var ss = s < 10 ? '0' + s : '' + s;
    return mm + ':' + ss;
  }

  function startTimer() {
    timeRemainingEl.textContent = formatTime(totalSeconds);
    timerInterval = setInterval(function() {
      totalSeconds--;
      if (totalSeconds <= 0) {
        totalSeconds = 0;
        clearInterval(timerInterval);
        handleTimeUp();
      }
      timeRemainingEl.textContent = formatTime(totalSeconds);
      if (totalSeconds <= 60 && !timeUp) {
        if (timerEl.className.indexOf('ending') === -1) {
          timerEl.className += ' ending';
        }
      }
    }, 1000);
  }

  function handleTimeUp() {
    timeUp = true;
    timerEl.className = timerEl.className.replace(' ending', '');
    if (timerEl.className.indexOf(' up') === -1) {
      timerEl.className += ' up';
    }
    if (document.body.className.indexOf('time-up') === -1) {
      document.body.className += ' time-up';
    }
    timeUpBanner.style.display = 'block';
    var allInputs = document.querySelectorAll('#reflectionForm input, #reflectionForm textarea');
    for (var i = 0; i < allInputs.length; i++) {
      allInputs[i].disabled = true;
    }
  }

  // ---------- STEPS ----------
  var steps = document.querySelectorAll('.step');
  var currentStep = 1;
  var totalSteps = steps.length; // 4

  function showStep(stepNumber) {
    for (var i = 0; i < steps.length; i++) {
      var step = steps[i];
      var target = Number(step.getAttribute('data-step')) === stepNumber;
      if (target) {
        if (step.className.indexOf('active') === -1) {
          step.className += ' active';
        }
      } else {
        step.className = step.className.replace(' active', '');
      }
    }
    currentStep = stepNumber;
    updateProgress();
  }

  // ---------- PROGRESS / XP / QUESTIONS COMPLETED ----------
  var progressFill = document.getElementById('progressFill');
  var progressText = document.getElementById('progressText');
  var scoreLabel = document.getElementById('scoreLabel');
  var rewardFlash = document.getElementById('rewardFlash');
  var quest1 = document.getElementById('quest1');
  var quest2 = document.getElementById('quest2');
  var quest3 = document.getElementById('quest3');
  var quest4 = document.getElementById('quest4');
  var copiedOnce = false;
  var rewardTimeout = null;

  function isMainQuestionAnswered(stepNumber) {
    var step = document.querySelector('.step[data-step="' + stepNumber + '"]');
    if (!step) return false;
    var checked = step.querySelector('input[type="radio"]:checked, input[type="checkbox"]:checked');
    if (checked) return true;
    var fields = step.querySelectorAll('textarea, input[type="text"]');
    for (var i = 0; i < fields.length; i++) {
      if (fields[i].value && fields[i].value.trim() !== '') {
        return true;
      }
    }
    return false;
  }

  function answeredQuestionsCount() {
    var count = 0;
    for (var i = 1; i <= totalSteps; i++) {
      if (isMainQuestionAnswered(i)) count++;
    }
    return count;
  }

  function setQuestCompleted(li, completed) {
    if (!li) return;
    var cls = li.className || '';
    if (completed) {
      if (cls.indexOf('completed') === -1) {
        li.className = cls ? (cls + ' completed') : 'completed';
      }
    } else {
      li.className = cls.replace('completed', '').trim();
    }
  }

  function updateQuests(percent) {
    setQuestCompleted(quest1, isMainQuestionAnswered(1));
    setQuestCompleted(quest2, isMainQuestionAnswered(2));
    setQuestCompleted(quest3, isMainQuestionAnswered(3));
    var allAnswered = answeredQuestionsCount() === totalSteps;
    setQuestCompleted(quest4, allAnswered && copiedOnce);
  }

  function showReward(message) {
    if (rewardTimeout) clearTimeout(rewardTimeout);
    rewardFlash.textContent = message;
    var cls = rewardFlash.className || '';
    if (cls.indexOf('visible') === -1) {
      rewardFlash.className = cls ? (cls + ' visible') : 'visible';
    }
    rewardTimeout = setTimeout(function() {
      rewardFlash.className = rewardFlash.className.replace(' visible', '');
    }, 1500);
  }

  function updateProgress() {
    var answered = answeredQuestionsCount();
    var percent = Math.round((answered / totalSteps) * 100);
    var xp = answered * 100; // 100 XP per main question
    progressFill.style.width = percent + '%';
    scoreLabel.textContent = xp + ' XP';

    if (percent === 0) {
      progressText.textContent = '0% ‚Äì answer each card to level up your self-story ‚≠ê';
    } else if (percent < 40) {
      progressText.textContent = percent + '% ‚Äì a strong start, you‚Äôre tuning into your identity üí°';
    } else if (percent < 100) {
      progressText.textContent = percent + '% ‚Äì you‚Äôre in the middle of the story, keep unfolding it ‚ú®';
    } else {
      progressText.textContent = '100% ‚Äì full run complete, identity snapshot unlocked üèÖ';
    }

    updateQuests(percent);
  }

  var questionAnsweredState = {1:false, 2:false, 3:false, 4:false};

  function checkQuestionReward(stepNumber) {
    var nowAnswered = isMainQuestionAnswered(stepNumber);
    if (nowAnswered && !questionAnsweredState[stepNumber]) {
      questionAnsweredState[stepNumber] = true;
      showReward('‚≠ê +100 XP ‚Äì Question ' + stepNumber + ' logged!');
    }
    updateProgress();
  }

  // simple helper to find closest parent with a class
  function closestWithClass(element, className, stopAt) {
    while (element && element !== stopAt && element.nodeType === 1) {
      if ((' ' + element.className + ' ').indexOf(' ' + className + ' ') > -1) {
        return element;
      }
      element = element.parentNode;
    }
    return null;
  }

  // ---------- OPTION PILL SELECTION ----------
  var optionGroups = document.querySelectorAll('.options-group');
  for (var og = 0; og < optionGroups.length; og++) {
    optionGroups[og].addEventListener('change', function(e) {
      var target = e.target || e.srcElement;
      if (!target || target.tagName !== 'INPUT') return;
      var pill = closestWithClass(target, 'option-pill', this);
      if (!pill) return;

      if (target.type === 'radio') {
        var allPills = this.querySelectorAll('.option-pill');
        for (var i = 0; i < allPills.length; i++) {
          allPills[i].className = allPills[i].className.replace(' selected', '');
        }
        if (pill.className.indexOf('selected') === -1) {
          pill.className += ' selected';
        }
      } else if (target.type === 'checkbox') {
        if (target.checked) {
          if (pill.className.indexOf('selected') === -1) {
            pill.className += ' selected';
          }
        } else {
          pill.className = pill.className.replace(' selected', '');
        }
      }

      var stepEl = closestWithClass(target, 'step', document.body);
      if (stepEl) {
        var stepNumber = Number(stepEl.getAttribute('data-step'));
        enableOrDisableButtonsForStep(stepNumber);
        checkQuestionReward(stepNumber);
      }
    });
  }

  // Also update when typing
  var reflectionForm = document.getElementById('reflectionForm');
  reflectionForm.addEventListener('input', function(e) {
    var target = e.target || e.srcElement;
    var stepEl = closestWithClass(target, 'step', document.body);
    if (stepEl) {
      var stepNumber = Number(stepEl.getAttribute('data-step'));
      enableOrDisableButtonsForStep(stepNumber);
      checkQuestionReward(stepNumber);
    }
  });

  function enableOrDisableButtonsForStep(stepNumber) {
    var stepEl = document.querySelector('.step[data-step="' + stepNumber + '"]');
    if (!stepEl) return;
    var answered = isMainQuestionAnswered(stepNumber);
    if (stepNumber === 1) {
      var nextBtn1 = document.getElementById('next1');
      nextBtn1.disabled = !answered;
    } else if (stepNumber === 2) {
      var nextBtn2 = document.getElementById('next2');
      nextBtn2.disabled = !answered;
    } else if (stepNumber === 3) {
      var nextBtn3 = document.getElementById('next3');
      nextBtn3.disabled = !answered;
    } else if (stepNumber === 4) {
      var finishBtn = document.getElementById('finishBtn');
      finishBtn.disabled = !answered;
    }
  }

  // ---------- STEP NAV BUTTONS ----------
  var next1 = document.getElementById('next1');
  var back2 = document.getElementById('back2');
  var next2 = document.getElementById('next2');
  var back3 = document.getElementById('back3');
  var next3 = document.getElementById('next3');
  var back4 = document.getElementById('back4');
  var finishBtn = document.getElementById('finishBtn');

  next1.addEventListener('click', function() { showStep(2); });
  back2.addEventListener('click', function() { showStep(1); });
  next2.addEventListener('click', function() { showStep(3); });
  back3.addEventListener('click', function() { showStep(2); });
  next3.addEventListener('click', function() { showStep(4); });
  back4.addEventListener('click', function() { showStep(3); });

  // When finish clicked, show results section + generate export
  finishBtn.addEventListener('click', function() {
    generateExportText();
    document.getElementById('resultsSection').style.display = 'block';
    copiedOnce = false; // they still need to press copy
    updateProgress();
    finishBtn.style.display = 'none';
    document.getElementById('resultsSection').scrollIntoView();
  });

  // Dash line
  var dashLine = '- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -';

  // ---------- EXPORT TEXT ----------
  function generateExportText() {
    var allQuestions = document.querySelectorAll('.question');
    var output = '';

    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    output += 'Section 1c ‚Äì Change, Conflict, Empowerment & Sharing: Reflection Summary\n';
    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';
    output += 'For each question below, all possible options are listed (where relevant).\n';
    output += 'Your own written notes follow each group of options where you added them.\n\n';

    for (var qIndex = 0; qIndex < allQuestions.length; qIndex++) {
      var q = allQuestions[qIndex];
      var mainPrompt = q.getAttribute('data-question') || ('Question ' + (qIndex + 1));
      output += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
      output += mainPrompt + '\n';

      var subQuestions = q.querySelectorAll('.sub-question');
      for (var sIndex = 0; sIndex < subQuestions.length; sIndex++) {
        var sub = subQuestions[sIndex];
        var subPrompt = sub.getAttribute('data-subquestion') || '';
        output += '\n ‚ñ∏ ' + subPrompt + '\n';

        var groups = sub.querySelectorAll('.options-group');
        for (var gIndex = 0; gIndex < groups.length; gIndex++) {
          var group = groups[gIndex];
          var labels = group.querySelectorAll('label.option-pill');
          if (labels.length > 0) {
            output += ' Options (* = chosen):\n';
            for (var lIndex = 0; lIndex < labels.length; lIndex++) {
              var label = labels[lIndex];
              var input = label.querySelector('input');
              var labelText = label.textContent.replace(/\s+/g, ' ').trim();
              var isSelected = input && input.checked;
              var prefix = isSelected ? '* ' : ' ';
              output += ' ' + prefix + labelText + '\n';
              output += dashLine + '\n';
            }
          }
        }

        var notes = [];
        var fields = sub.querySelectorAll('textarea, input[type="text"]');
        for (var fIndex = 0; fIndex < fields.length; fIndex++) {
          var field = fields[fIndex];
          if (field.value && field.value.trim() !== '') {
            notes.push(field.value.trim());
          }
        }

        if (notes.length > 0) {
          output += ' Notes and narrative reflections:\n';
          for (var nIndex = 0; nIndex < notes.length; nIndex++) {
            output += ' ‚Ä¢ ' + notes[nIndex] + '\n';
          }
        } else {
          output += ' Notes and narrative reflections:\n';
          output += ' ‚Ä¢ (no additional written notes provided for this part)\n';
        }
      }
      output += '\n';
    }

    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    output += 'End of Section 1c\n';
    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';

    document.getElementById('resultsBox').value = output;
  }

  // ---------- COPY BUTTON ----------
  var copyButton = document.getElementById('copyButton');
  copyButton.addEventListener('click', function() {
    var statusMessage = document.getElementById('statusMessage');
    var text = document.getElementById('resultsBox').value;

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text)
        .then(function() {
          statusMessage.textContent = '‚ú® Reflection copied! You can now paste it into an email or document.';
          copiedOnce = true;
          updateProgress();
        })
        .catch(function() {
          statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
        });
    } else {
      var box = document.getElementById('resultsBox');
      box.focus();
      box.select();
      try {
        var successful = document.execCommand('copy');
        if (successful) {
          statusMessage.textContent = '‚ú® Reflection copied! You can now paste it into an email or document.';
          copiedOnce = true;
          updateProgress();
        } else {
          statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
        }
      } catch (e) {
        statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
      }
    }
  });

  // ---------- INIT ----------
  startTimer();
  updateProgress();
  enableOrDisableButtonsForStep(1);
</script>
</body>
</html>
