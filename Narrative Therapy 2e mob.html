<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Section 2e: Significant Life Events</title>

  <!-- Make layout behave properly on mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  <style>
    * {
      box-sizing: border-box;
    }

    /* Prevent mobile browsers (especially iOS Safari) from random text zooming */
    html {
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #1e3a8a 0, #4f46e5 25%, #ec4899 60%, #f97316 100%);
      color: #111827;
    }

    .layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      display: flex;
      align-items: flex-start;
      gap: 24px;
      min-height: 100vh; /* helps avoid top-half floating on some devices */
    }

    .sidebar {
      width: 260px;
      flex: 0 0 260px;
      position: sticky;
      top: 16px;
      align-self: flex-start;
    }

    .page {
      flex: 1;
      min-width: 0;
    }

    h1 {
      font-size: 1.9rem;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #f9fafb;
      text-shadow: 0 2px 10px rgba(0,0,0,0.45);
    }

    h1 span.badge {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(251,191,36,0.95);
      color: #78350f;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }

    p.intro {
      margin-top: 0;
      margin-bottom: 1.2rem;
      font-size: 0.95rem;
      color: #e5e7eb;
      max-width: 760px;
      text-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }

    /* Sidebar cards (stats + timer) */
    .gamify-panel {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(30,64,175,0.98));
      border-radius: 18px;
      padding: 10px 14px;
      border: 1px solid rgba(191,219,254,0.3);
      box-shadow: 0 10px 25px rgba(15,23,42,0.7);
      color: #e5e7eb;
      position: relative;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .gamify-panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(251,191,36,0.3) 0, transparent 50%),
        radial-gradient(circle at 80% 0%, rgba(236,72,153,0.3) 0, transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(34,197,94,0.3) 0, transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .gamify-inner {
      position: relative;
      z-index: 1;
    }

    .gamify-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
      font-size: 0.84rem;
    }

    .gamify-header strong {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    #scoreLabel {
      font-weight: 700;
      font-size: 0.9rem;
      background: rgba(15,23,42,0.8);
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(248,250,252,0.15);
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.7);
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.6);
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #fbbf24, #fb923c, #ec4899, #22c55e);
      background-size: 200% 100%;
      animation: progressGlow 4s linear infinite;
      transition: width 0.3s ease-out;
    }

    @keyframes progressGlow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    .progress-label {
      margin-top: 4px;
      font-size: 0.78rem;
      color: #e5e7eb;
      display: none; /* hidden by design */
    }

    .quest-log {
      margin-top: 4px;
      border-top: 1px solid rgba(148,163,184,0.35);
      padding-top: 4px;
    }

    .quest-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
      margin-bottom: 2px;
    }

    .quest-list {
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 0.75rem;
    }

    .quest-list li {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 2px;
      opacity: 0.9;
    }

    .quest-badge {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.68rem;
      background: rgba(15,23,42,0.8);
    }

    .quest-list li.completed {
      color: #bbf7d0;
    }

    .quest-list li.completed .quest-badge {
      background: radial-gradient(circle at 30% 0, #fef3c7 0, #22c55e 40%, #166534 100%);
      border-color: #bbf7d0;
      box-shadow: 0 0 6px rgba(34,197,94,0.9);
    }

    .quest-list li.completed .quest-badge::before {
      content: "‚úì";
    }

    .quest-list li:not(.completed) .quest-badge::before {
      content: "";
    }

    .reward-flash {
      margin-top: 2px;
      font-size: 0.78rem;
      color: #fef3c7;
      opacity: 0;
      transform: translateY(4px);
      transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    }

    .reward-flash.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .timer {
      display: inline-flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 3px;
      padding: 8px 11px;
      border-radius: 16px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(248,250,252,0.2);
      box-shadow: 0 6px 18px rgba(15,23,42,0.7);
      font-size: 0.88rem;
      color: #e5e7eb;
    }

    .timer span.label {
      opacity: 0.8;
      font-size: 0.78rem;
    }

    .timer span.time {
      font-weight: 800;
      font-size: 1.2rem;
      letter-spacing: 0.08em;
    }

    .timer.ending {
      border-color: #f97373;
      color: #fecaca;
      box-shadow: 0 0 14px rgba(248,113,113,0.7);
    }

    .timer.up {
      opacity: 0.7;
    }

    .time-up-banner {
      display: none;
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(254,242,242,0.96);
      color: #991b1b;
      border: 1px solid #fecaca;
      font-size: 0.84rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .time-up .time-up-banner {
      display: block;
    }

    .time-up #reflectionForm input,
    .time-up #reflectionForm textarea {
      pointer-events: none;
      opacity: 0.9;
    }

    .card {
      background: #f9fafb;
      border-radius: 18px;
      padding: 18px 16px;
      box-shadow: 0 10px 22px rgba(15,23,42,0.25);
      border: 1px solid #e5e7eb;
      position: relative;
      overflow: hidden;
    }

    .card-title {
      font-weight: 700;
      margin-bottom: 6px;
      color: #111827;
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
      color: #111827;
    }

    .question-text {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }

    textarea,
    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font: inherit;
      font-size: 1rem;   /* ensure consistent size and avoid iOS zoom */
      line-height: 1.4;
      background: #ffffff;
      min-height: 70px;
      resize: vertical;
      transition:
        border-color 0.15s ease-out,
        box-shadow 0.15s ease-out,
        transform 0.05s ease-out;
    }

    textarea:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 2px rgba(129,140,248,0.4);
      transform: translateY(-1px);
    }

    .options-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin: 8px 0 10px;
    }

    .option-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(129,140,248,0.7);
      font-size: 0.9rem;
      background: rgba(239,246,255,0.95);
      cursor: pointer;
      user-select: none;
      transition:
        transform 0.05s ease-out,
        box-shadow 0.05s ease-out,
        background 0.1s ease-out,
        border-color 0.1s ease-out,
        color 0.1s ease-out;
    }

    /* Force consistent answer font size on all devices */
    .options-group .option-pill {
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .options-group .option-pill input {
      font-size: 1rem;
    }

    .option-pill input {
      accent-color: #4b6bfb;
    }

    .option-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(148,163,184,0.8);
    }

    .option-pill.selected {
      background: linear-gradient(135deg, #22c55e, #a855f7);
      color: #f9fafb;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(55,65,81,0.7);
    }

    .option-pill.selected input {
      accent-color: #fef9c3;
    }

    .sub-question {
      margin-top: 12px;
      display: none;
    }

    .sub-question.active {
      display: block;
    }

    .sub-question-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }

    .step {
      display: none;
    }

    .step.active {
      display: block;
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 14px;
      gap: 10px;
    }

    button {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-weight: 700;
      font-size: 0.9rem;
      background: radial-gradient(circle at 0% 0%, #f97316, #ec4899, #6366f1);
      color: #f9fafb;
      box-shadow: 0 8px 18px rgba(15,23,42,0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: transform 0.07s ease, box-shadow 0.07s ease, opacity 0.1s ease;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 11px 22px rgba(15,23,42,0.8);
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow: 0 5px 11px rgba(15,23,42,0.75);
    }

    button:disabled {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
    }

    .secondary {
      background: #e5e7eb;
      color: #111827;
      box-shadow: 0 4px 10px rgba(55,65,81,0.5);
      text-transform: none;
      letter-spacing: 0.01em;
    }

    /* Sub-question navigation (per main question) */
    .sub-nav {
      margin-top: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .sub-nav .sub-status {
      font-size: 0.8rem;
      font-weight: 600;
      color: #374151;
    }

    .sub-nav .sub-prev,
    .sub-nav .sub-next {
      font-size: 0.8rem;
      padding: 8px 14px;
    }

    #resultsBox {
      width: 100%;
      min-height: 200px;
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      border: 1px dashed #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.9rem;
      background: #f9fafb;
      box-shadow: inset 0 0 8px rgba(148,163,184,0.5);
      white-space: pre-wrap;
    }

    .status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #16a34a;
      min-height: 1.2em;
    }

    .footer-note {
      margin-top: 12px;
      font-size: 0.8rem;
      color: #e5e7eb;
    }

    /* Mobile & tablet layout tweaks */
    @media (max-width: 900px) {
      .layout {
        flex-direction: column;
        align-items: stretch;
        padding: 16px 12px 24px;
      }

      .sidebar {
        width: 100%;
        flex: none;
        position: static;
        order: -1;
      }

      .page {
        width: 100%;
      }
    }
  </style>
</head>
<body>
<div class="layout">
  <!-- Sidebar with stats + timer -->
  <aside class="sidebar">
    <div class="gamify-panel">
      <div class="gamify-inner">
        <div class="gamify-header">
          <strong>Narrative Therapy Progress</strong>
          <span id="scoreLabel">0</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-label" id="progressText">
          <!-- hidden via CSS -->
        </div>
        <div class="quest-log">
          <div class="quest-title">Questions Completed</div>
          <ul class="quest-list">
            <li id="quest1"><span class="quest-badge"></span>Complete Question 15</li>
            <li id="quest2"><span class="quest-badge"></span>Complete Question 16</li>
            <li id="quest3"><span class="quest-badge"></span>Complete Question 17</li>
            <li id="quest4"><span class="quest-badge"></span>Complete Question 17 &amp; copy</li>
          </ul>
        </div>
        <div class="reward-flash" id="rewardFlash">
          ‚≠ê Insight logged!
        </div>
      </div>
    </div>

    <div class="timer" id="timer">
      <span class="label">‚è±Ô∏è Time left (this section)</span>
      <span class="time" id="timeRemaining">30:00</span>
      <span style="font-size:0.75rem; opacity:0.75;">Up to 30 minutes to complete this week's narrative.</span>
    </div>
  </aside>

  <!-- Main question page -->
  <main class="page">
    <h1>
      Section 2e: Significant Life Events
    </h1>
    <p class="intro">
      This sequence explores difficult decisions that involved sacrifice, moments of personal empowerment,
      and cultural or societal experiences that shaped how you see the world. Move through Questions 15, 16, and 17 one at a time.
      At the end you‚Äôll be able to copy a formatted reflection to send on.
    </p>

    <div class="time-up-banner" id="timeUpBanner">
      The 30 minutes for this reflection have finished. Your answers are still here ‚Äì you can review them and copy them at the end.
    </div>

    <form id="reflectionForm">
      <!-- STEP 1 ‚Äì QUESTION 15 -->
      <div class="step active" data-step="1">
        <div class="card question" data-question="15. A difficult decision that required personal sacrifice or compromise">
          <div class="card-title">Question 15 ‚Äì A difficult decision with personal sacrifice</div>

          <!-- 15a -->
          <div class="sub-question" data-subquestion="15a. The context of this difficult decision">
            <div class="sub-question-title">
              Reflect on a time when you made a difficult decision that required personal sacrifice or compromise.
            </div>
            <div class="question-text">
              What was the context of this decision?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q15a" value="Choosing between competing personal or professional goals that felt equally important to you.">
                A. Choosing between competing personal or professional goals that felt equally important to you.
              </label>
              <label class="option-pill">
                <input type="radio" name="q15a" value="Making a decision that deeply affected a relationship, family member, or loved one.">
                B. Making a decision that deeply affected a relationship, family member, or loved one.
              </label>
              <label class="option-pill">
                <input type="radio" name="q15a" value="Balancing your own needs, desires, or goals with the needs of others around you.">
                C. Balancing your own needs, desires, or goals with the needs of others around you.
              </label>
              <label class="option-pill">
                <input type="radio" name="q15a" value="A moral or ethical dilemma that challenged your values or personal principles.">
                D. A moral or ethical dilemma that challenged your values or personal principles.
              </label>
              <label class="option-pill">
                <input type="radio" name="q15a" value="Moving away from something or someone familiar to pursue growth or a new opportunity.">
                E. Moving away from something or someone familiar to pursue growth or a new opportunity.
              </label>
              <label class="option-pill">
                <input type="radio" name="q15a" value="Accepting an outcome that didn‚Äôt fully align with your expectations or desires.">
                F. Accepting an outcome that didn‚Äôt fully align with your expectations or desires.
              </label>
              <label class="option-pill">
                <input type="radio" name="q15a" value="I don‚Äôt recall making a decision that required significant personal or emotional sacrifice.">
                G. I don‚Äôt recall making a decision that required significant personal or emotional sacrifice.
              </label>
              <label class="option-pill">
                <input type="radio" name="q15a" value="Other / Not Listed (please specify).">
                H. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q15a_other"
                      placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe this decision in more detail, you can write about it here."></textarea>
          </div>

          <!-- 15b follow-up -->
          <div class="sub-question" data-subquestion="15b. Lessons or insights from making this difficult decision">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              What important lessons or insights did you learn from making this difficult decision, and how do you apply them now?
            </div>
            <textarea id="q15_follow"
                      placeholder="You might write about what you now know about yourself, your values, or how you handle complex choices."></textarea>
          </div>
        </div>

        <!-- sub-question navigation for Question 15 will be injected here by JS -->
        <div class="nav-buttons">
          <span></span>
          <button type="button" id="next1" disabled>Next Question ‚Æï</button>
        </div>
      </div>

      <!-- STEP 2 ‚Äì QUESTION 16 -->
      <div class="step" data-step="2">
        <div class="card question" data-question="16. A moment of empowerment or agency over your life">
          <div class="card-title">Question 16 ‚Äì A moment of empowerment or agency</div>

          <!-- 16a -->
          <div class="sub-question" data-subquestion="16a. The type of moment that gave you a sense of empowerment">
            <div class="sub-question-title">
              Think about a moment when you felt a strong sense of empowerment or agency over your life.
            </div>
            <div class="question-text">
              What type of moment gave you this feeling of empowerment?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q16a" value="Achieving a goal, milestone, or accomplishment entirely through your own efforts and determination.">
                A. Achieving a goal, milestone, or accomplishment entirely through your own efforts and determination.
              </label>
              <label class="option-pill">
                <input type="radio" name="q16a" value="Standing up for yourself or someone else in a situation that required courage and resolve.">
                B. Standing up for yourself or someone else in a situation that required courage and resolve.
              </label>
              <label class="option-pill">
                <input type="radio" name="q16a" value="Taking on a leadership role or responsibility that allowed you to make a meaningful impact.">
                C. Taking on a leadership role or responsibility that allowed you to make a meaningful impact.
              </label>
              <label class="option-pill">
                <input type="radio" name="q16a" value="Overcoming a significant fear, obstacle, or challenge entirely on your own.">
                D. Overcoming a significant fear, obstacle, or challenge entirely on your own.
              </label>
              <label class="option-pill">
                <input type="radio" name="q16a" value="Taking a major step toward independence or self-sufficiency in your personal or professional life.">
                E. Taking a major step toward independence or self-sufficiency in your personal or professional life.
              </label>
              <label class="option-pill">
                <input type="radio" name="q16a" value="Choosing to take a risk that paid off, despite your initial fear or doubt.">
                F. Choosing to take a risk that paid off, despite your initial fear or doubt.
              </label>
              <label class="option-pill">
                <input type="radio" name="q16a" value="I don‚Äôt recall feeling a strong sense of empowerment or agency in my life.">
                G. I don‚Äôt recall feeling a strong sense of empowerment or agency in my life.
              </label>
              <label class="option-pill">
                <input type="radio" name="q16a" value="Other / Not Listed (please specify).">
                H. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q16a_other"
                      placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe this empowering moment more fully, you can write about it here."></textarea>
          </div>

          <!-- 16b follow-up -->
          <div class="sub-question" data-subquestion="16b. How this empowering moment shaped your confidence and actions">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              How did this empowering moment shape your confidence, actions, or ability to take on challenges in the future?
            </div>
            <textarea id="q16_follow"
                      placeholder="You might write about how this moment changed what you believe you‚Äôre capable of, or how you respond to challenges now."></textarea>
          </div>
        </div>

        <!-- sub-question navigation for Question 16 will be injected here by JS -->
        <div class="nav-buttons">
          <button type="button" class="secondary" id="back2">‚Æú Back</button>
          <button type="button" id="next2" disabled>Next Question ‚Æï</button>
        </div>
      </div>

      <!-- STEP 3 ‚Äì QUESTION 17 -->
      <div class="step" data-step="3">
        <div class="card question" data-question="17. A cultural or societal event that impacted your perspective">
          <div class="card-title">Question 17 ‚Äì A cultural or societal event that shaped your perspective</div>

          <!-- 17a -->
          <div class="sub-question" data-subquestion="17a. The type of cultural or societal event that impacted you most">
            <div class="sub-question-title">
              What type of cultural or societal event has impacted your perspective on the world and your place in it the most?
            </div>
            <div class="options-group">
              <label class="option-pill">
                <input type="radio" name="q17a" value="A historical or political event that you personally witnessed or actively participated in.">
                A. A historical or political event that you personally witnessed or actively participated in.
              </label>
              <label class="option-pill">
                <input type="radio" name="q17a" value="A cultural celebration, tradition, or festival that connected you to a larger community.">
                B. A cultural celebration, tradition, or festival that connected you to a larger community.
              </label>
              <label class="option-pill">
                <input type="radio" name="q17a" value="A global, national, or local movement that inspired change or new ways of thinking.">
                C. A global, national, or local movement that inspired change or new ways of thinking.
              </label>
              <label class="option-pill">
                <input type="radio" name="q17a" value="A deeply personal experience that made you reflect on societal norms, values, or priorities.">
                D. A deeply personal experience that made you reflect on societal norms, values, or priorities.
              </label>
              <label class="option-pill">
                <input type="radio" name="q17a" value="Observing or participating in a moment of collective resilience or unity during a crisis.">
                E. Observing or participating in a moment of collective resilience or unity during a crisis.
              </label>
              <label class="option-pill">
                <input type="radio" name="q17a" value="Witnessing or learning about acts of injustice or inequality that deeply impacted you.">
                F. Witnessing or learning about acts of injustice or inequality that deeply impacted you.
              </label>
              <label class="option-pill">
                <input type="radio" name="q17a" value="I don‚Äôt recall experiencing a significant cultural or societal event that has impacted me deeply.">
                G. I don‚Äôt recall experiencing a significant cultural or societal event that has impacted me deeply.
              </label>
              <label class="option-pill">
                <input type="radio" name="q17a" value="Other / Not Listed (please specify).">
                H. Other / Not Listed (please specify):
              </label>
            </div>
            <textarea id="q17a_other"
                      placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe this experience more fully, you can write about it here."></textarea>
          </div>

          <!-- 17b follow-up -->
          <div class="sub-question" data-subquestion="17b. How this cultural or societal experience influenced your worldview">
            <div class="sub-question-title">Optional follow-up:</div>
            <div class="question-text">
              How has this cultural or societal experience influenced the way you see, understand, or interact with the world?
            </div>
            <textarea id="q17_follow"
                      placeholder="You might write about changes in your beliefs, priorities, or how you relate to your community or society."></textarea>
          </div>
        </div>

        <!-- sub-question navigation for Question 17 will be injected here by JS -->
        <div class="nav-buttons">
          <button type="button" class="secondary" id="back3">‚Æú Back</button>
          <button type="button" id="finishBtn" disabled>Finish</button>
        </div>
      </div>
    </form>

    <div id="resultsSection" style="display:none; margin-top:20px;">
      <h2 style="color:#f9fafb; text-shadow:0 2px 6px rgba(0,0,0,0.45);">Your Reflection Export</h2>
      <p class="intro">
        Below is your formatted reflection. It includes every option for each question, plus your written notes.
      </p>
      <button type="button" id="copyButton">üìã Copy this reflection</button>
      <div class="status" id="statusMessage"></div>
      <textarea id="resultsBox" readonly></textarea>
      <p class="footer-note">
        After clicking ‚ÄúCopy this reflection‚Äù, go to your email or message app and use <strong>Paste</strong> (Ctrl+V / Cmd+V).
      </p>
    </div>
  </main>
</div>

<script>
  // ES5-friendly script with no arrow functions / let / const

  // ---------- TIMER (30 MINUTES) ----------
  var totalSeconds = 30 * 60;
  var timerInterval = null;
  var timeUp = false;
  var timerEl = document.getElementById('timer');
  var timeRemainingEl = document.getElementById('timeRemaining');
  var timeUpBanner = document.getElementById('timeUpBanner');

  function formatTime(seconds) {
    var m = Math.floor(seconds / 60);
    var s = seconds % 60;
    var mm = m < 10 ? '0' + m : '' + m;
    var ss = s < 10 ? '0' + s : '' + s;
    return mm + ':' + ss;
  }

  function startTimer() {
    timeRemainingEl.textContent = formatTime(totalSeconds);
    timerInterval = setInterval(function() {
      totalSeconds--;
      if (totalSeconds <= 0) {
        totalSeconds = 0;
        clearInterval(timerInterval);
        handleTimeUp();
      }
      timeRemainingEl.textContent = formatTime(totalSeconds);
      if (totalSeconds <= 60 && !timeUp) {
        if (timerEl.className.indexOf('ending') === -1) {
          timerEl.className += ' ending';
        }
      }
    }, 1000);
  }

  function handleTimeUp() {
    timeUp = true;
    timerEl.className = timerEl.className.replace(' ending', '');
    if (timerEl.className.indexOf(' up') === -1) {
      timerEl.className += ' up';
    }
    if (document.body.className.indexOf('time-up') === -1) {
      document.body.className += ' time-up';
    }
    timeUpBanner.style.display = 'block';

    var allInputs = document.querySelectorAll('#reflectionForm input, #reflectionForm textarea');
    for (var i = 0; i < allInputs.length; i++) {
      allInputs[i].disabled = true;
    }
  }

  // ---------- STEPS ----------
  var steps = document.querySelectorAll('.step');
  var currentStep = 1;
  var totalSteps = steps.length; // 3

  function showStep(stepNumber) {
    for (var i = 0; i < steps.length; i++) {
      var step = steps[i];
      var target = Number(step.getAttribute('data-step')) === stepNumber;
      if (target) {
        if (step.className.indexOf('active') === -1) {
          step.className += ' active';
        }
      } else {
        step.className = step.className.replace(' active', '');
      }
    }
    currentStep = stepNumber;
    updateProgress();

    if (subQuestionState[stepNumber]) {
      updateSubNav(stepNumber);
    }
  }

  // ---------- PROGRESS / XP / QUESTIONS COMPLETED ----------
  var progressFill = document.getElementById('progressFill');
  var progressText = document.getElementById('progressText');
  var scoreLabel = document.getElementById('scoreLabel');
  var rewardFlash = document.getElementById('rewardFlash');
  var quest1 = document.getElementById('quest1');
  var quest2 = document.getElementById('quest2');
  var quest3 = document.getElementById('quest3');
  var quest4 = document.getElementById('quest4');
  var copiedOnce = false;
  var rewardTimeout = null;

  function isMainQuestionAnswered(stepNumber) {
    var step = document.querySelector('.step[data-step="' + stepNumber + '"]');
    if (!step) return false;

    var checked = step.querySelector('input[type="radio"]:checked, input[type="checkbox"]:checked');
    if (checked) return true;

    var fields = step.querySelectorAll('textarea, input[type="text"]');
    for (var i = 0; i < fields.length; i++) {
      if (fields[i].value && fields[i].value.trim() !== '') {
        return true;
      }
    }
    return false;
  }

  function answeredQuestionsCount() {
    var count = 0;
    for (var i = 1; i <= totalSteps; i++) {
      if (isMainQuestionAnswered(i)) count++;
    }
    return count;
  }

  function setQuestCompleted(li, completed) {
    if (!li) return;
    var cls = li.className || '';
    if (completed) {
      if (cls.indexOf('completed') === -1) {
        li.className = cls ? (cls + ' completed') : 'completed';
      }
    } else {
      li.className = cls.replace('completed', '').trim();
    }
  }

  function updateQuests(percent) {
    setQuestCompleted(quest1, isMainQuestionAnswered(1));
    setQuestCompleted(quest2, isMainQuestionAnswered(2));
    setQuestCompleted(quest3, isMainQuestionAnswered(3));

    var allAnswered = answeredQuestionsCount() === totalSteps;
    setQuestCompleted(quest4, allAnswered && copiedOnce);
  }

  function showReward(message) {
    if (rewardTimeout) clearTimeout(rewardTimeout);
    rewardFlash.textContent = message;
    var cls = rewardFlash.className || '';
    if (cls.indexOf('visible') === -1) {
      rewardFlash.className = cls ? (cls + ' visible') : 'visible';
    }
    rewardTimeout = setTimeout(function() {
      rewardFlash.className = rewardFlash.className.replace(' visible', '');
    }, 1500);
  }

  function updateProgress() {
    var answered = answeredQuestionsCount();
    var percent = Math.round((answered / totalSteps) * 100);
    var xp = answered * 100; // 100 XP per main question

    progressFill.style.width = percent + '%';
    scoreLabel.textContent = xp;

    if (percent === 0) {
      progressText.textContent = '0% ‚Äì answer each card to level up your self-story ‚≠ê';
    } else if (percent < 40) {
      progressText.textContent = percent + '% ‚Äì a strong start, you‚Äôre tuning into your story üí°';
    } else if (percent < 100) {
      progressText.textContent = percent + '% ‚Äì you‚Äôre in the middle of the story, keep unfolding it ‚ú®';
    } else {
      progressText.textContent = '100% ‚Äì full run complete, perspective snapshot unlocked üèÖ';
    }
    updateQuests(percent);
  }

  var questionAnsweredState = {1:false, 2:false, 3:false};

  function checkQuestionReward(stepNumber) {
    var nowAnswered = isMainQuestionAnswered(stepNumber);
    if (nowAnswered && !questionAnsweredState[stepNumber]) {
      questionAnsweredState[stepNumber] = true;
      // stepNumber 1‚ÜíQ15, 2‚ÜíQ16, 3‚ÜíQ17
      showReward('‚≠ê Question ' + (stepNumber + 14) + ' logged!');
    }
    updateProgress();
  }

  // helper: closest parent with a class
  function closestWithClass(element, className, stopAt) {
    while (element && element !== stopAt && element.nodeType === 1) {
      if ((' ' + element.className + ' ').indexOf(' ' + className + ' ') > -1) {
        return element;
      }
      element = element.parentNode;
    }
    return null;
  }

  // ---------- SUB-QUESTION "PAGES" (ONE VISIBLE PER MAIN QUESTION) ----------
  var subQuestionState = {}; // stepNumber -> { index, nodes, prevBtn, nextBtn, statusEl }

  function initSubQuestions() {
    for (var i = 0; i < steps.length; i++) {
      var step = steps[i];
      var stepNumber = Number(step.getAttribute('data-step'));
      var subs = step.querySelectorAll('.sub-question');

      if (!subQuestionState[stepNumber]) {
        subQuestionState[stepNumber] = { index: 0, nodes: subs };
      } else {
        subQuestionState[stepNumber].nodes = subs;
      }

      for (var j = 0; j < subs.length; j++) {
        subs[j].className = subs[j].className.replace(' active', '');
      }
      if (subs.length > 0) {
        if (subs[0].className.indexOf('active') === -1) {
          subs[0].className += ' active';
        }
      }

      if (subs.length > 1) {
        var nav = document.createElement('div');
        nav.className = 'sub-nav';

        var prevBtn = document.createElement('button');
        prevBtn.type = 'button';
        prevBtn.className = 'secondary sub-prev';
        prevBtn.textContent = '‚Æú Previous part';

        var status = document.createElement('span');
        status.className = 'sub-status';

        var nextBtn = document.createElement('button');
        nextBtn.type = 'button';
        nextBtn.className = 'sub-next';
        nextBtn.textContent = 'Next part ‚Æï';

        nav.appendChild(prevBtn);
        nav.appendChild(status);
        nav.appendChild(nextBtn);

        var card = step.querySelector('.card.question');
        var navButtons = step.querySelector('.nav-buttons');
        if (card && navButtons) {
          step.insertBefore(nav, navButtons);
        } else {
          step.appendChild(nav);
        }

        subQuestionState[stepNumber].prevBtn = prevBtn;
        subQuestionState[stepNumber].nextBtn = nextBtn;
        subQuestionState[stepNumber].statusEl = status;

        (function(stepNum) {
          prevBtn.addEventListener('click', function() {
            changeSubQuestion(stepNum, -1);
          });
          nextBtn.addEventListener('click', function() {
            changeSubQuestion(stepNum, 1);
          });
        })(stepNumber);
      }
    }

    for (var s = 1; s <= steps.length; s++) {
      if (subQuestionState[s]) {
        updateSubNav(s);
      }
    }
  }

  function updateSubNav(stepNumber) {
    var state = subQuestionState[stepNumber];
    if (!state || !state.nodes || !state.nodes.length) return;

    var total = state.nodes.length;
    var idx = state.index;

    if (idx < 0) idx = 0;
    if (idx >= total) idx = total - 1;
    state.index = idx;

    for (var i = 0; i < total; i++) {
      var sub = state.nodes[i];
      sub.className = sub.className.replace(' active', '');
      if (i === idx) {
        if (sub.className.indexOf('active') === -1) {
          sub.className += ' active';
        }
      }
    }

    if (state.prevBtn) {
      state.prevBtn.disabled = (idx === 0);
    }
    if (state.nextBtn) {
      state.nextBtn.disabled = (idx === total - 1);
    }
    if (state.statusEl) {
      state.statusEl.textContent = 'Part ' + (idx + 1) + ' of ' + total;
    }

    if (stepNumber === 1) {
      var nextBtn1 = document.getElementById('next1');
      if (nextBtn1) {
        nextBtn1.style.display = (idx === total - 1) ? 'inline-flex' : 'none';
      }
    } else if (stepNumber === 2) {
      var nextBtn2 = document.getElementById('next2');
      if (nextBtn2) {
        nextBtn2.style.display = (idx === total - 1) ? 'inline-flex' : 'none';
      }
    } else if (stepNumber === 3) {
      var finishBtn = document.getElementById('finishBtn');
      if (finishBtn) {
        finishBtn.style.display = (idx === total - 1) ? 'inline-flex' : 'none';
      }
    }
  }

  function changeSubQuestion(stepNumber, direction) {
    var state = subQuestionState[stepNumber];
    if (!state || !state.nodes || !state.nodes.length) return;

    var newIndex = state.index + direction;
    if (newIndex < 0) newIndex = 0;
    if (newIndex >= state.nodes.length) newIndex = state.nodes.length - 1;
    if (newIndex === state.index) return;

    state.index = newIndex;
    updateSubNav(stepNumber);
    enableOrDisableButtonsForStep(stepNumber);
  }

  // ---------- OPTION PILL SELECTION ----------
  var optionGroups = document.querySelectorAll('.options-group');
  for (var og = 0; og < optionGroups.length; og++) {
    optionGroups[og].addEventListener('change', function(e) {
      var target = e.target || e.srcElement;
      if (!target || target.tagName !== 'INPUT') return;

      var pill = closestWithClass(target, 'option-pill', this);
      if (!pill) return;

      if (target.type === 'radio') {
        var allPills = this.querySelectorAll('.option-pill');
        for (var i = 0; i < allPills.length; i++) {
          allPills[i].className = allPills[i].className.replace(' selected', '');
        }
        if (pill.className.indexOf('selected') === -1) {
          pill.className += ' selected';
        }
      } else if (target.type === 'checkbox') {
        if (target.checked) {
          if (pill.className.indexOf('selected') === -1) {
            pill.className += ' selected';
          }
        } else {
          pill.className = pill.className.replace(' selected', '');
        }
      }

      var stepEl = closestWithClass(target, 'step', document.body);
      if (stepEl) {
        var stepNumber = Number(stepEl.getAttribute('data-step'));
        enableOrDisableButtonsForStep(stepNumber);
        checkQuestionReward(stepNumber);
      }
    });
  }

  // also update when typing
  var reflectionForm = document.getElementById('reflectionForm');
  reflectionForm.addEventListener('input', function(e) {
    var target = e.target || e.srcElement;
    var stepEl = closestWithClass(target, 'step', document.body);
    if (stepEl) {
      var stepNumber = Number(stepEl.getAttribute('data-step'));
      enableOrDisableButtonsForStep(stepNumber);
      checkQuestionReward(stepNumber);
    }
  });

  function enableOrDisableButtonsForStep(stepNumber) {
    var stepEl = document.querySelector('.step[data-step="' + stepNumber + '"]');
    if (!stepEl) return;

    var answered = isMainQuestionAnswered(stepNumber);

    if (stepNumber === 1) {
      var nextBtn1 = document.getElementById('next1');
      if (nextBtn1) nextBtn1.disabled = !answered;
    } else if (stepNumber === 2) {
      var nextBtn2 = document.getElementById('next2');
      if (nextBtn2) nextBtn2.disabled = !answered;
    } else if (stepNumber === 3) {
      var finishBtn = document.getElementById('finishBtn');
      if (finishBtn) finishBtn.disabled = !answered;
    }
  }

  // ---------- STEP NAV BUTTONS ----------
  var next1 = document.getElementById('next1');
  var back2 = document.getElementById('back2');
  var next2 = document.getElementById('next2');
  var back3 = document.getElementById('back3');
  var finishBtn = document.getElementById('finishBtn');

  next1.addEventListener('click', function() { showStep(2); });
  back2.addEventListener('click', function() { showStep(1); });
  next2.addEventListener('click', function() { showStep(3); });
  back3.addEventListener('click', function() { showStep(2); });

  // finish: show results + generate export
  finishBtn.addEventListener('click', function() {
    generateExportText();
    document.getElementById('resultsSection').style.display = 'block';
    copiedOnce = false;
    updateProgress();
    finishBtn.style.display = 'none';
    document.getElementById('resultsSection').scrollIntoView();
  });

  // Dash line used after each option
  var dashLine = '- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -';

  // ---------- EXPORT TEXT ----------
  function generateExportText() {
    var allQuestions = document.querySelectorAll('.question');
    var output = '';

    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    output += 'Section 2e: Significant Life Events ‚Äì Reflection Summary\n';
    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';
    output += 'For each question below, all possible options are listed.\n';
    output += 'Your own written notes follow each group of options where you added them.\n\n';

    for (var qIndex = 0; qIndex < allQuestions.length; qIndex++) {
      var q = allQuestions[qIndex];
      var mainPrompt = q.getAttribute('data-question') || ('Question ' + (qIndex + 1));

      output += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
      output += mainPrompt + '\n';

      var subQuestions = q.querySelectorAll('.sub-question');
      for (var sIndex = 0; sIndex < subQuestions.length; sIndex++) {
        var sub = subQuestions[sIndex];
        var subPrompt = sub.getAttribute('data-subquestion') || '';
        output += '\n ‚ñ∏ ' + subPrompt + '\n';

        var groups = sub.querySelectorAll('.options-group');
        for (var gIndex = 0; gIndex < groups.length; gIndex++) {
          var group = groups[gIndex];
          var labels = group.querySelectorAll('label.option-pill');
          if (labels.length > 0) {
            output += ' Options:\n';
            for (var lIndex = 0; lIndex < labels.length; lIndex++) {
              var label = labels[lIndex];
              var input = label.querySelector('input');
              var labelText = label.textContent.replace(/\s+/g, ' ').trim();
              output += ' - ' + labelText + '\n';
              output += dashLine + '\n';
            }
          }
        }

        var notes = [];
        var fields = sub.querySelectorAll('textarea, input[type="text"]');
        for (var fIndex = 0; fIndex < fields.length; fIndex++) {
          var field = fields[fIndex];
          if (field.value && field.value.trim() !== '') {
            notes.push(field.value.trim());
          }
        }

        if (notes.length > 0) {
          output += ' Notes and narrative reflections:\n';
          for (var nIndex = 0; nIndex < notes.length; nIndex++) {
            output += ' ‚Ä¢ ' + notes[nIndex] + '\n';
          }
        } else {
          output += ' Notes and narrative reflections:\n';
          output += ' ‚Ä¢ (no additional written notes provided for this part)\n';
        }
      }
      output += '\n';
    }

    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    output += 'End of this Section\n';
    output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';

    document.getElementById('resultsBox').value = output;
  }

  // ---------- COPY BUTTON ----------
  var copyButton = document.getElementById('copyButton');
  copyButton.addEventListener('click', function() {
    var statusMessage = document.getElementById('statusMessage');
    var text = document.getElementById('resultsBox').value;

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text)
        .then(function() {
          statusMessage.textContent = '‚ú® Reflection copied! You can now paste it into an email or document.';
          copiedOnce = true;
          updateProgress();
        })
        .catch(function() {
          statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
        });
    } else {
      var box = document.getElementById('resultsBox');
      box.focus();
      box.select();
      try {
        var successful = document.execCommand('copy');
        if (successful) {
          statusMessage.textContent = '‚ú® Reflection copied! You can now paste it into an email or document.';
          copiedOnce = true;
          updateProgress();
        } else {
          statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
        }
      } catch (e) {
        statusMessage.textContent = 'Copy failed. Please select all the text in the box and copy it manually.';
      }
    }
  });

  // ---------- INIT ----------
  initSubQuestions();
  startTimer();
  showStep(1);
  updateProgress();
  enableOrDisableButtonsForStep(1);
</script>
</body>
</html>
