<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Proper mobile viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Section 1a ‚Äì Identity & Self-Discovery Quest</title>
  <style>
    * { box-sizing: border-box; }

    html {
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #1e3a8a 0, #4f46e5 25%, #ec4899 60%, #f97316 100%);
      color: #111827;
    }
    .layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      display: flex;
      align-items: flex-start;
      gap: 24px;
    }
    .sidebar {
      width: 260px;
      flex: 0 0 260px;
      position: sticky;
      top: 16px;
      align-self: flex-start;
    }
    .page { flex: 1; min-width: 0; }

    h1 {
      font-size: 1.9rem;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #f9fafb;
      text-shadow: 0 2px 10px rgba(0,0,0,0.45);
    }
    p.intro {
      margin-top: 0;
      margin-bottom: 1.2rem;
      font-size: 0.95rem;
      color: #e5e7eb;
      max-width: 760px;
      text-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }

    .gamify-panel {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(30,64,175,0.98));
      border-radius: 18px;
      padding: 10px 14px;
      border: 1px solid rgba(191,219,254,0.3);
      box-shadow: 0 10px 25px rgba(15,23,42,0.7);
      color: #e5e7eb;
      position: relative;
      overflow: hidden;
      margin-bottom: 12px;
    }
    .gamify-panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(251,191,36,0.3) 0, transparent 50%),
        radial-gradient(circle at 80% 0%, rgba(236,72,153,0.3) 0, transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(34,197,94,0.3) 0, transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }
    .gamify-inner { position: relative; z-index: 1; }
    .gamify-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
      font-size: 0.84rem;
    }
    .gamify-header strong {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    #scoreLabel {
      font-weight: 700;
      font-size: 0.9rem;
      background: rgba(15,23,42,0.8);
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(248,250,252,0.15);
    }
    .progress-bar {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.7);
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.6);
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #fbbf24, #fb923c, #ec4899, #22c55e);
      background-size: 200% 100%;
      animation: progressGlow 4s linear infinite;
      transition: width 0.3s ease-out;
    }
    @keyframes progressGlow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }
    .progress-label { margin-top: 4px; font-size: 0.78rem; color: #e5e7eb; display: none; }

    .quest-log {
      margin-top: 4px;
      border-top: 1px solid rgba(148,163,184,0.35);
      padding-top: 4px;
    }
    .quest-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
      margin-bottom: 2px;
    }
    .quest-list { list-style: none; margin: 0; padding: 0; font-size: 0.75rem; }
    .quest-list li { display: flex; align-items: center; gap: 5px; margin-bottom: 2px; opacity: 0.9; }
    .quest-badge {
      width: 14px; height: 14px; border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      display: inline-flex; align-items: center; justify-content: center;
      font-size: 0.68rem;
      background: rgba(15,23,42,0.8);
    }
    .quest-list li.completed { color: #bbf7d0; }
    .quest-list li.completed .quest-badge {
      background: radial-gradient(circle at 30% 0, #fef3c7 0, #22c55e 40%, #166534 100%);
      border-color: #bbf7d0;
      box-shadow: 0 0 6px rgba(34,197,94,0.9);
    }
    .quest-list li.completed .quest-badge::before { content: "‚úì"; }
    .quest-list li:not(.completed) .quest-badge::before { content: ""; }

    .reward-flash {
      margin-top: 2px;
      font-size: 0.78rem;
      color: #fef3c7;
      opacity: 0;
      transform: translateY(4px);
      transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    }
    .reward-flash.visible { opacity: 1; transform: translateY(0); }

    .timer {
      display: inline-flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 3px;
      padding: 8px 11px;
      border-radius: 16px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(248,250,252,0.2);
      box-shadow: 0 6px 18px rgba(15,23,42,0.7);
      font-size: 0.88rem;
      color: #e5e7eb;
    }
    .timer span.label { opacity: 0.8; font-size: 0.78rem; }
    .timer span.time { font-weight: 800; font-size: 1.2rem; letter-spacing: 0.08em; }
    .timer.ending { border-color: #f97373; color: #fecaca; box-shadow: 0 0 14px rgba(248,113,113,0.7); }
    .timer.up { opacity: 0.7; }

    .time-up-banner {
      display: none;
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(254,242,242,0.96);
      color: #991b1b;
      border: 1px solid #fecaca;
      font-size: 0.84rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .time-up .time-up-banner { display: block; }
    .time-up #reflectionForm input,
    .time-up #reflectionForm textarea {
      pointer-events: none;
      opacity: 0.9;
    }

    .card {
      background: #f9fafb;
      border-radius: 18px;
      padding: 18px 16px;
      box-shadow: 0 10px 22px rgba(15,23,42,0.25);
      border: 1px solid #e5e7eb;
      position: relative;
      overflow: hidden;
    }
    .card-title { font-weight: 700; margin-bottom: 6px; color: #111827; }

    label { font-weight: 600; display: block; margin-bottom: 4px; color: #111827; }
    .question-text { font-size: 0.95rem; margin-bottom: 6px; }

    textarea, input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font: inherit;
      background: #ffffff;
      min-height: 70px;
      resize: vertical;
      transition: border-color 0.15s ease-out, box-shadow 0.15s ease-out, transform 0.05s ease-out;
    }
    textarea:focus, input[type="text"]:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 2px rgba(129,140,248,0.4);
      transform: translateY(-1px);
    }

    .options-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin: 8px 0 10px;
    }
    .option-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(129,140,248,0.7);
      font-size: 0.9rem;
      background: rgba(239,246,255,0.95);
      cursor: pointer;
      user-select: none;
      transition: transform 0.05s ease-out, box-shadow 0.05s ease-out, background 0.1s ease-out, border-color 0.1s ease-out, color 0.1s ease-out;
    }
    .option-pill input { accent-color: #4b6bfb; }
    .option-pill:hover { transform: translateY(-1px); box-shadow: 0 2px 5px rgba(148,163,184,0.8); }
    .option-pill.selected {
      background: linear-gradient(135deg, #22c55e, #a855f7);
      color: #f9fafb;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(55,65,81,0.7);
    }
    .option-pill.selected input { accent-color: #fef9c3; }

    .sub-question { margin-top: 12px; }
    .sub-question-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 4px; color: #111827; }

    .step { display: none; }
    .step.active { display: block; }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 14px;
      gap: 10px;
    }

    button {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-weight: 700;
      font-size: 0.9rem;
      background: radial-gradient(circle at 0% 0%, #f97316, #ec4899, #6366f1);
      color: #f9fafb;
      box-shadow: 0 8px 18px rgba(15,23,42,0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: transform 0.07s ease, box-shadow 0.07s ease, opacity 0.1s ease;
    }
    button:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 11px 22px rgba(15,23,42,0.8); }
    button:active:not(:disabled) { transform: translateY(1px); box-shadow: 0 5px 11px rgba(15,23,42,0.75); }
    button:disabled { opacity: 0.45; cursor: default; box-shadow: none; }

    .secondary {
      background: #e5e7eb;
      color: #111827;
      box-shadow: 0 4px 10px rgba(55,65,81,0.5);
      text-transform: none;
      letter-spacing: 0.01em;
    }

    .status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #16a34a;
      min-height: 1.2em;
    }

    @media (max-width: 900px) {
      .layout { flex-direction: column; }
      .sidebar { width: 100%; flex: none; position: static; order: -1; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="gamify-panel">
        <div class="gamify-inner">
          <div class="gamify-header">
            <strong>Narrative Therapy Progress</strong>
            <span id="scoreLabel">0</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-label" id="progressText">
            0% ‚Äì answer each card to level up your self-story ‚≠ê
          </div>
          <div class="quest-log">
            <div class="quest-title">Questions Completed</div>
            <ul class="quest-list">
              <li id="quest1"><span class="quest-badge"></span>Complete Question 1</li>
              <li id="quest2"><span class="quest-badge"></span>Complete Question 2</li>
              <li id="quest3"><span class="quest-badge"></span>Complete Question 3 & copy</li>
            </ul>
          </div>
          <div class="reward-flash" id="rewardFlash">
            ‚≠ê +10 ‚Äì Nice insight.
          </div>
        </div>
      </div>

      <div class="timer" id="timer">
        <span class="label">‚è±Ô∏è Time left (Section 1a)</span>
        <span class="time" id="timeRemaining">30:00</span>
        <span style="font-size:0.75rem; opacity:0.75;">Up to 30 minutes to complete this week's narrative.</span>
      </div>
    </aside>

    <main class="page">
      <h1>Section 1a: Identity & Self-Discovery</h1>
      <p class="intro">
        One question at a time, at your pace. Follow your first impressions rather than over-thinking ‚Äì this is about
        capturing a living snapshot of how your identity feels right now. When you‚Äôve finished all three questions,
        you‚Äôll be able to copy a neatly formatted log and send it on.
      </p>

      <div class="time-up-banner" id="timeUpBanner">
        The 30 minutes for this reflection have finished. Your answers are still here ‚Äì you can review them and copy them at the end.
      </div>

      <form id="reflectionForm">
        <!-- STEP 1 -->
        <div class="step active" data-step="1">
          <div class="card question" data-question="1. Moment of strong identity">
            <div class="card-title">Question 1 ‚Äì A moment of strong identity</div>

            <div class="sub-question" data-subquestion="1a. Circumstances that contributed to your strong sense of identity">
              <div class="sub-question-title">Reflect on a moment when you felt a strong sense of your own identity.</div>
              <div class="question-text">What were the circumstances that contributed to your strong sense of identity?</div>
              <div class="options-group">
                <label class="option-pill"><input type="radio" name="q1a" value="Achieving a significant personal or professional milestone.">A. Achieving a significant personal or professional milestone.</label>
                <label class="option-pill"><input type="radio" name="q1a" value="Overcoming a challenge or adversity.">B. Overcoming a challenge or adversity.</label>
                <label class="option-pill"><input type="radio" name="q1a" value="Receiving affirmation or recognition from others.">C. Receiving affirmation or recognition from others.</label>
                <label class="option-pill"><input type="radio" name="q1a" value="Engaging in an activity or tradition that felt meaningful.">D. Engaging in an activity or tradition that felt meaningful.</label>
                <label class="option-pill"><input type="radio" name="q1a" value="Discovering or reconnecting with a value, belief, or passion you hold dear.">E. Discovering or reconnecting with a value, belief, or passion you hold dear.</label>
                <label class="option-pill"><input type="radio" name="q1a" value="Other / Not Listed (please specify).">F. Other / Not Listed (please specify):</label>
              </div>
              <textarea id="q1a_other" placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to expand on the moment, you can write about it here."></textarea>
            </div>

            <div class="sub-question" data-subquestion="1b. How this moment shaped your self-perception">
              <div class="sub-question-title">How did this moment shape and influence your understanding of your self-perception?</div>
              <div class="options-group">
                <label class="option-pill"><input type="radio" name="q1b" value="It strengthened your confidence in who you are.">A. It strengthened your confidence in who you are.</label>
                <label class="option-pill"><input type="radio" name="q1b" value="It clarified what matters most to you.">B. It clarified what matters most to you.</label>
                <label class="option-pill"><input type="radio" name="q1b" value="It helped you to see your strengths more clearly.">C. It helped you to see your strengths more clearly.</label>
                <label class="option-pill"><input type="radio" name="q1b" value="It inspired you to embrace your individuality.">D. It inspired you to embrace your individuality.</label>
                <label class="option-pill"><input type="radio" name="q1b" value="It reinforced a sense of connection to your values or your heritage.">E. It reinforced a sense of connection to your values or your heritage.</label>
                <label class="option-pill"><input type="radio" name="q1b" value="Other / Not Listed (please specify).">F. Other / Not Listed (please specify):</label>
              </div>
              <textarea id="q1b_other" placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to add nuance about how this moment shaped your view of yourself, you can write it here."></textarea>
            </div>

            <div class="sub-question" data-subquestion="1c. Drawing on this experience in challenging times">
              <div class="sub-question-title">Optional follow-up:</div>
              <div class="question-text">How can you draw on this experience to reinforce your sense of identity, especially during challenging or uncertain times?</div>
              <textarea id="q1_follow" placeholder="You might write about reminders, rituals, people, or phrases that help you return to this version of yourself."></textarea>
            </div>
          </div>

          <div class="nav-buttons">
            <span></span>
            <button type="button" id="next1" disabled>Next Part ‚Æï</button>
          </div>
        </div>

        <!-- STEP 2 -->
        <div class="step" data-step="2">
          <div class="card question" data-question="2. Questioning or doubting an aspect of identity">
            <div class="card-title">Question 2 ‚Äì Questioning an aspect of your identity</div>

            <div class="sub-question" data-subquestion="2a. Factors or experiences that prompted you to question this aspect of identity">
              <div class="sub-question-title">Think about a time when you questioned or doubted an important aspect of your identity.</div>
              <div class="question-text">What were the specific factors or experiences that prompted you to question this aspect of your identity?</div>
              <div class="options-group">
                <label class="option-pill"><input type="radio" name="q2a" value="A major life event or a time of transition.">A. A major life event or a time of transition.</label>
                <label class="option-pill"><input type="radio" name="q2a" value="Feedback or criticism from others.">B. Feedback or criticism from others.</label>
                <label class="option-pill"><input type="radio" name="q2a" value="Exposure to new ideas or perspectives.">C. Exposure to new ideas or perspectives.</label>
                <label class="option-pill"><input type="radio" name="q2a" value="Internal doubts or self-reflection.">D. Internal doubts or self-reflection.</label>
                <label class="option-pill"><input type="radio" name="q2a" value="Experiencing a sense of disconnect between your identity and your environment.">E. Experiencing a sense of disconnect between your identity and your environment.</label>
                <label class="option-pill"><input type="radio" name="q2a" value="Other / Not Listed (please specify).">F. Other / Not Listed (please specify):</label>
              </div>
              <textarea id="q2a_other" placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe this time more fully, you can write about it here."></textarea>
            </div>

            <div class="sub-question" data-subquestion="2b. What you discovered or realised about yourself through this process">
              <div class="sub-question-title">What did you discover or realise about yourself through this process of questioning your identity?</div>
              <div class="options-group">
                <label class="option-pill"><input type="radio" name="q2b" value="Greater clarity about your values or priorities.">A. Greater clarity about your values or priorities.</label>
                <label class="option-pill"><input type="radio" name="q2b" value="New aspects of yourself you had not hitherto explored.">B. New aspects of yourself you had not hitherto explored.</label>
                <label class="option-pill"><input type="radio" name="q2b" value="That your identity is flexible and evolving.">C. That your identity is flexible and evolving.</label>
                <label class="option-pill"><input type="radio" name="q2b" value="Strength in areas you had not recognised before.">D. Strength in areas you had not recognised before.</label>
                <label class="option-pill"><input type="radio" name="q2b" value="The importance of authenticity and aligning with your true self.">E. The importance of authenticity and aligning with your true self.</label>
                <label class="option-pill"><input type="radio" name="q2b" value="Other / Not Listed (please specify).">F. Other / Not Listed (please specify):</label>
              </div>
              <textarea id="q2b_other" placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to say more about what you discovered, you can write it here."></textarea>
            </div>

            <div class="sub-question" data-subquestion="2c. What you learned about questioning and evolving your identity">
              <div class="sub-question-title">Optional follow-up:</div>
              <div class="question-text">What did you learn about the process of questioning and evolving your identity, and how has this shaped your current self-perception and life choices?</div>
              <textarea id="q2_follow" placeholder="You might write about what felt destabilising, what felt clarifying, and how this experience influences choices you make now."></textarea>
            </div>
          </div>

          <div class="nav-buttons">
            <button type="button" class="secondary" id="back2">‚Æú Back</button>
            <button type="button" id="next2" disabled>Next Part ‚Æï</button>
          </div>
        </div>

        <!-- STEP 3 -->
        <div class="step" data-step="3">
          <div class="card question" data-question="3. A moment of pride in who you are">
            <div class="card-title">Question 3 ‚Äì A moment of pride in who you are</div>

            <div class="sub-question" data-subquestion="3a. Factors that contributed to this feeling of pride">
              <div class="sub-question-title">Think about a specific moment when you felt a deep sense of pride in who you are.</div>
              <div class="question-text">What were the key factors or experiences that contributed to this feeling of pride?</div>
              <div class="options-group">
                <label class="option-pill"><input type="radio" name="q3a" value="Overcoming a personal challenge or achieving a goal.">A. Overcoming a personal challenge or achieving a goal.</label>
                <label class="option-pill"><input type="radio" name="q3a" value="Being recognised for your unique qualities.">B. Being recognised for your unique qualities.</label>
                <label class="option-pill"><input type="radio" name="q3a" value="Advocating for yourself or standing up for your values.">C. Advocating for yourself or standing up for your values.</label>
                <label class="option-pill"><input type="radio" name="q3a" value="Connecting with your cultural, family, or personal history.">D. Connecting with your cultural, family, or personal history.</label>
                <label class="option-pill"><input type="radio" name="q3a" value="Mentoring, supporting, or inspiring someone else in a meaningful way.">E. Mentoring, supporting, or inspiring someone else in a meaningful way.</label>
                <label class="option-pill"><input type="radio" name="q3a" value="Other / Not Listed (please specify).">F. Other / Not Listed (please specify):</label>
              </div>
              <textarea id="q3a_other" placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe this proud moment in your own words, you can write it here."></textarea>
            </div>

            <div class="sub-question" data-subquestion="3b. How this experience impacted your personal or professional life">
              <div class="sub-question-title">How did this experience impact or influence your personal or professional life?</div>
              <div class="options-group">
                <label class="option-pill"><input type="radio" name="q3b" value="It inspired you to set new goals.">A. It inspired you to set new goals.</label>
                <label class="option-pill"><input type="radio" name="q3b" value="It strengthened your confidence in your abilities.">B. It strengthened your confidence in your abilities.</label>
                <label class="option-pill"><input type="radio" name="q3b" value="It deepened your appreciation for your journey.">C. It deepened your appreciation for your journey.</label>
                <label class="option-pill"><input type="radio" name="q3b" value="It motivated you to share your story with others.">D. It motivated you to share your story with others.</label>
                <label class="option-pill"><input type="radio" name="q3b" value="It enhanced your understanding of the value of perseverance.">E. It enhanced your understanding of the value of perseverance.</label>
                <label class="option-pill"><input type="radio" name="q3b" value="Other / Not Listed (please specify).">F. Other / Not Listed (please specify):</label>
              </div>
              <textarea id="q3b_other" placeholder="If ‚ÄòOther‚Äô or if you‚Äôd like to describe the impact in more detail, you can write it here."></textarea>
            </div>

            <div class="sub-question" data-subquestion="3c. Celebrating and integrating what made you proud">
              <div class="sub-question-title">Optional follow-up:</div>
              <div class="question-text">How can you celebrate and honor the qualities that made you proud in that moment, and how can you integrate them into your daily life moving forward?</div>
              <textarea id="q3_follow" placeholder="You might write about daily practices, ways of speaking to yourself, or decisions that honour this proud version of you."></textarea>
            </div>
          </div>

          <div class="nav-buttons">
            <button type="button" class="secondary" id="back3">‚Æú Back</button>
            <button type="button" id="finishBtn" disabled>Next Part ‚Æï</button>
          </div>
        </div>
      </form>

      <!-- RESULTS (no visible textbox now) -->
      <div id="resultsSection" style="display:none; margin-top:20px;">
        <h2 style="color:#f9fafb; text-shadow:0 2px 6px rgba(0,0,0,0.45);">Your Reflection Export</h2>
        <p class="intro">
          Click the button to copy your formatted reflection to your clipboard.
        </p>
        <button type="button" id="copyButton">üìã Copy this reflection</button>
        <div class="status" id="statusMessage"></div>
      </div>
    </main>
  </div>

  <script>
    // ---------- TIMER (30 MINUTES) ----------
    let totalSeconds = 30 * 60;
    let timerInterval = null;
    let timeUp = false;

    const timerEl = document.getElementById('timer');
    const timeRemainingEl = document.getElementById('timeRemaining');
    const timeUpBanner = document.getElementById('timeUpBanner');

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      const mm = m < 10 ? '0' + m : '' + m;
      const ss = s < 10 ? '0' + s : '' + s;
      return mm + ':' + ss;
    }

    function startTimer() {
      timeRemainingEl.textContent = formatTime(totalSeconds);
      timerInterval = setInterval(() => {
        totalSeconds--;
        if (totalSeconds <= 0) {
          totalSeconds = 0;
          clearInterval(timerInterval);
          handleTimeUp();
        }
        timeRemainingEl.textContent = formatTime(totalSeconds);
        if (totalSeconds <= 60 && !timeUp) {
          timerEl.classList.add('ending');
        }
      }, 1000);
    }

    function handleTimeUp() {
      timeUp = true;
      timerEl.classList.remove('ending');
      timerEl.classList.add('up');
      document.body.classList.add('time-up');
      timeUpBanner.style.display = 'block';
      const allInputs = document.querySelectorAll('#reflectionForm input, #reflectionForm textarea');
      allInputs.forEach(el => el.disabled = true);
    }

    // ---------- STEPS ----------
    const steps = document.querySelectorAll('.step');
    let currentStep = 1;
    const totalSteps = steps.length;

    function showStep(stepNumber) {
      steps.forEach(step => {
        step.classList.toggle('active', Number(step.dataset.step) === stepNumber);
      });
      currentStep = stepNumber;
      updatePageVisibility(stepNumber);
      updateProgress();
      enableOrDisableButtonsForStep(stepNumber);
    }

    // ---------- PROGRESS / QUESTIONS COMPLETED ----------
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const scoreLabel = document.getElementById('scoreLabel');
    const rewardFlash = document.getElementById('rewardFlash');
    const quest1 = document.getElementById('quest1');
    const quest2 = document.getElementById('quest2');
    const quest3 = document.getElementById('quest3');

    let copiedOnce = false;
    let rewardTimeout = null;

    function isMainQuestionAnswered(stepNumber) {
      const step = document.querySelector('.step[data-step="' + stepNumber + '"]');
      if (!step) return false;

      const checked = step.querySelector('input[type="radio"]:checked, input[type="checkbox"]:checked');
      if (checked) return true;

      const fields = step.querySelectorAll('textarea, input[type="text"]');
      for (const field of fields) {
        if (field.value && field.value.trim() !== '') return true;
      }
      return false;
    }

    function answeredQuestionsCount() {
      let count = 0;
      for (let i = 1; i <= totalSteps; i++) if (isMainQuestionAnswered(i)) count++;
      return count;
    }

    function updateQuests(percent) {
      quest1.classList.toggle('completed', isMainQuestionAnswered(1));
      quest2.classList.toggle('completed', isMainQuestionAnswered(2));
      const allAnswered = answeredQuestionsCount() === totalSteps;
      quest3.classList.toggle('completed', allAnswered && copiedOnce);
    }

    function showReward(message) {
      if (rewardTimeout) clearTimeout(rewardTimeout);
      rewardFlash.textContent = message;
      rewardFlash.classList.add('visible');
      rewardTimeout = setTimeout(() => rewardFlash.classList.remove('visible'), 1500);
    }

    function updateProgress() {
      const answered = answeredQuestionsCount();
      const percent = Math.round((answered / totalSteps) * 100);
      const score = answered * 100;

      progressFill.style.width = percent + '%';
      scoreLabel.textContent = score;

      if (percent === 0) {
        progressText.textContent = '0% ‚Äì answer each card to level up your self-story ‚≠ê';
      } else if (percent < 40) {
        progressText.textContent = percent + '% ‚Äì a strong start, you‚Äôre tuning into your identity üí°';
      } else if (percent < 100) {
        progressText.textContent = percent + '% ‚Äì you‚Äôre in the middle of the story, keep unfolding it ‚ú®';
      } else {
        progressText.textContent = '100% ‚Äì full run complete, identity snapshot unlocked üèÖ';
      }

      updateQuests(percent);
    }

    const questionAnsweredState = {1:false, 2:false, 3:false};

    function checkQuestionReward(stepNumber) {
      const nowAnswered = isMainQuestionAnswered(stepNumber);
      if (nowAnswered && !questionAnsweredState[stepNumber]) {
        questionAnsweredState[stepNumber] = true;
        showReward('‚≠ê +100 ‚Äì Question ' + stepNumber + ' logged!');
      }
      updateProgress();
    }

    // ---------- PAGINATION PER QUESTION (optional follow-ups on their own pages) ----------
    const questionPageElems = {1: [], 2: [], 3: []};
    const currentPages = {1: 0, 2: 0, 3: 0};

    function initQuestionPages() {
      function getSubQuestion(label) {
        return document.querySelector('.sub-question[data-subquestion="' + label + '"]');
      }

      // Q1 pages: [1a], [1b], [1c]
      questionPageElems[1] = [
        [ getSubQuestion('1a. Circumstances that contributed to your strong sense of identity') ],
        [ getSubQuestion('1b. How this moment shaped your self-perception') ],
        [ getSubQuestion('1c. Drawing on this experience in challenging times') ]
      ];

      // Q2 pages: [2a], [2b], [2c]
      questionPageElems[2] = [
        [ getSubQuestion('2a. Factors or experiences that prompted you to question this aspect of identity') ],
        [ getSubQuestion('2b. What you discovered or realised about yourself through this process') ],
        [ getSubQuestion('2c. What you learned about questioning and evolving your identity') ]
      ];

      // Q3 pages: [3a], [3b], [3c]
      questionPageElems[3] = [
        [ getSubQuestion('3a. Factors that contributed to this feeling of pride') ],
        [ getSubQuestion('3b. How this experience impacted your personal or professional life') ],
        [ getSubQuestion('3c. Celebrating and integrating what made you proud') ]
      ];

      // Hide all sub-questions initially
      [1,2,3].forEach(stepNumber => {
        const stepEl = document.querySelector('.step[data-step="' + stepNumber + '"]');
        if (!stepEl) return;
        stepEl.querySelectorAll('.sub-question').forEach(sq => sq.style.display = 'none');
      });

      updatePageVisibility(1);
    }

    function updatePageVisibility(stepNumber) {
      const stepEl = document.querySelector('.step[data-step="' + stepNumber + '"]');
      if (!stepEl) return;

      stepEl.querySelectorAll('.sub-question').forEach(sq => sq.style.display = 'none');

      const pages = questionPageElems[stepNumber];
      if (!pages || pages.length === 0) return;

      const currentIndex = currentPages[stepNumber] || 0;
      (pages[currentIndex] || []).forEach(sqEl => { if (sqEl) sqEl.style.display = 'block'; });

      // Update button labels
      if (stepNumber === 1) {
        const nextBtn = document.getElementById('next1');
        if (nextBtn) nextBtn.textContent = (currentIndex < pages.length - 1) ? 'Next Part ‚Æï' : 'Next Question ‚Æï';
      } else if (stepNumber === 2) {
        const nextBtn = document.getElementById('next2');
        if (nextBtn) nextBtn.textContent = (currentIndex < pages.length - 1) ? 'Next Part ‚Æï' : 'Next Question ‚Æï';
      } else if (stepNumber === 3) {
        const finishBtn = document.getElementById('finishBtn');
        if (finishBtn) finishBtn.textContent = (currentIndex < pages.length - 1) ? 'Next Part ‚Æï' : 'Finish';
      }
    }

    // ---------- OPTION PILL SELECTION ----------
    document.querySelectorAll('.options-group').forEach(group => {
      group.addEventListener('change', (e) => {
        const target = e.target;
        if (!target || target.tagName !== 'INPUT') return;

        const pill = target.closest('.option-pill');
        if (!pill) return;

        if (target.type === 'radio') {
          group.querySelectorAll('.option-pill').forEach(p => p.classList.remove('selected'));
          pill.classList.add('selected');
        } else if (target.type === 'checkbox') {
          pill.classList.toggle('selected', target.checked);
        }

        const stepEl = target.closest('.step');
        if (stepEl) {
          const stepNumber = Number(stepEl.dataset.step);
          enableOrDisableButtonsForStep(stepNumber);
          checkQuestionReward(stepNumber);
        }
      });
    });

    document.getElementById('reflectionForm').addEventListener('input', (e) => {
      const stepEl = e.target.closest('.step');
      if (stepEl) {
        const stepNumber = Number(stepEl.dataset.step);
        enableOrDisableButtonsForStep(stepNumber);
        checkQuestionReward(stepNumber);
      }
    });

    function enableOrDisableButtonsForStep(stepNumber) {
      const answered = isMainQuestionAnswered(stepNumber);
      if (stepNumber === 1) document.getElementById('next1').disabled = !answered;
      if (stepNumber === 2) document.getElementById('next2').disabled = !answered;
      if (stepNumber === 3) document.getElementById('finishBtn').disabled = !answered;
    }

    // ---------- STEP NAV BUTTONS WITH INTERNAL PAGES ----------
    function handleNextPage(stepNumber) {
      const pages = questionPageElems[stepNumber];
      const currentIndex = currentPages[stepNumber] || 0;

      if (pages && currentIndex < pages.length - 1) {
        currentPages[stepNumber] = currentIndex + 1;
        updatePageVisibility(stepNumber);
        enableOrDisableButtonsForStep(stepNumber);
      } else {
        const nextStep = stepNumber + 1;
        if (nextStep <= totalSteps) showStep(nextStep);
      }
    }

    function handleBackPage(stepNumber) {
      const pages = questionPageElems[stepNumber];
      const currentIndex = currentPages[stepNumber] || 0;

      if (pages && currentIndex > 0) {
        currentPages[stepNumber] = currentIndex - 1;
        updatePageVisibility(stepNumber);
        enableOrDisableButtonsForStep(stepNumber);
      } else {
        const prevStep = stepNumber - 1;
        if (prevStep >= 1) {
          const prevPages = questionPageElems[prevStep];
          if (prevPages && prevPages.length > 0) currentPages[prevStep] = prevPages.length - 1;
          showStep(prevStep);
        }
      }
    }

    document.getElementById('next1').addEventListener('click', () => handleNextPage(1));
    document.getElementById('back2').addEventListener('click', () => handleBackPage(2));
    document.getElementById('next2').addEventListener('click', () => handleNextPage(2));
    document.getElementById('back3').addEventListener('click', () => handleBackPage(3));

    // ---------- EXPORT TEXT ----------
    const dashLine = '- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -';
    let exportText = '';

    function generateExportText() {
      const allQuestions = document.querySelectorAll('.question');
      let output = '';

      output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
      output += 'Section 1a ‚Äì Identity & Self-Discovery: Reflection Summary\n';
      output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';

      output += 'For each question below, all possible options are listed.\n';
      output += 'An asterisk (*) marks the options you selected; unmarked options were not selected.\n';
      output += 'Your own written notes follow each group of options where you added them.\n\n';

      allQuestions.forEach((q, index) => {
        const mainPrompt = q.dataset.question || ('Question ' + (index + 1));
        output += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
        output += mainPrompt + '\n';

        const subQuestions = q.querySelectorAll('.sub-question');
        subQuestions.forEach(sub => {
          const subPrompt = sub.dataset.subquestion || '';
          output += '\n ‚ñ∏ ' + subPrompt + '\n';

          const groups = sub.querySelectorAll('.options-group');
          groups.forEach(group => {
            const labels = group.querySelectorAll('label.option-pill');
            if (labels.length > 0) {
              output += ' Options (* = chosen):\n';
              labels.forEach(label => {
                const input = label.querySelector('input');
                const labelText = label.textContent.trim().replace(/\s+/g, ' ');
                const isSelected = input && input.checked;
                const prefix = isSelected ? '* ' : ' ';
                output += ' ' + prefix + labelText + '\n';
                output += dashLine + '\n';
              });
            }
          });

          const notes = [];
          sub.querySelectorAll('textarea, input[type="text"]').forEach(field => {
            if (field.value && field.value.trim() !== '') notes.push(field.value.trim());
          });

          output += ' Notes and narrative reflections:\n';
          if (notes.length > 0) {
            notes.forEach(note => output += ' ‚Ä¢ ' + note + '\n');
          } else {
            output += ' ‚Ä¢ (no additional written notes provided for this part)\n';
          }
        });

        output += '\n';
      });

      output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
      output += 'End of Section 1a\n';
      output += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';

      exportText = output;
      return output;
    }

    // ---------- FINISH ----------
    document.getElementById('finishBtn').addEventListener('click', () => {
      const stepNumber = 3;
      const pages = questionPageElems[stepNumber];
      const currentIndex = currentPages[stepNumber] || 0;

      if (pages && currentIndex < pages.length - 1) {
        currentPages[stepNumber] = currentIndex + 1;
        updatePageVisibility(stepNumber);
        enableOrDisableButtonsForStep(stepNumber);
        return;
      }

      // Final page: generate + show results
      generateExportText();
      document.getElementById('resultsSection').style.display = 'block';
      copiedOnce = false;
      updateProgress();

      const finishBtn = document.getElementById('finishBtn');
      finishBtn.style.display = 'none';

      document.getElementById('resultsSection').scrollIntoView({behavior: 'smooth'});
    });

    // ---------- COPY BUTTON (no visible textbox) ----------
    document.getElementById('copyButton').addEventListener('click', () => {
      const statusMessage = document.getElementById('statusMessage');
      const text = exportText || generateExportText();

      function fallbackCopy(t) {
        const temp = document.createElement('textarea');
        temp.value = t;
        temp.setAttribute('readonly', '');
        temp.style.position = 'fixed';
        temp.style.left = '-9999px';
        temp.style.top = '0';
        document.body.appendChild(temp);
        temp.select();
        try {
          document.execCommand('copy');
          statusMessage.textContent = '‚ú® Reflection copied! You can now paste it into an email or document.';
          copiedOnce = true;
          updateProgress();
        } catch (e) {
          statusMessage.textContent = 'Copy failed. Your device blocked clipboard access.';
        } finally {
          document.body.removeChild(temp);
        }
      }

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
          .then(() => {
            statusMessage.textContent = '‚ú® Reflection copied! You can now paste it into an email or document.';
            copiedOnce = true;
            updateProgress();
          })
          .catch(() => fallbackCopy(text));
      } else {
        fallbackCopy(text);
      }
    });

    // ---------- INIT ----------
    startTimer();
    updateProgress();
    enableOrDisableButtonsForStep(1);
    initQuestionPages();
  </script>
</body>
</html>
